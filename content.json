{"meta":{"title":"HomeLabProject","subtitle":"","description":"å®¶é‡Œå¼€IDCï¼Œä½†æ˜¯ä»€ä¹ˆéƒ½ä¸ä¼šï¼Œä¸€é—®ä¸‰ä¸çŸ¥","author":"Channing He","url":"https://homelabproject.cc","root":"/"},"pages":[{"title":"","date":"2025-06-19T04:44:25.212Z","updated":"2025-06-19T04:44:25.212Z","comments":true,"path":"custom.css","permalink":"https://homelabproject.cc/custom.css","excerpt":"","text":":root{--gutter:25px;--radius:13px;--color-primary:#1c6c36;--color2:#ff761e;--color3:#ffb900;--color4:#33d57a;--color5:#00dbff;--color6:#1a98ff;--color7:#9090ff;--color-primary-bg:rgba(20, 103, 10, 0.15);--color2-bg:rgba(255,118,30,0.15);--color3-bg:rgba(255,185,0,0.15);--color4-bg:rgba(51,213,122,0.15);--color5-bg:rgba(0,219,255,0.15);--color6-bg:rgba(26,152,255,0.15);--color7-bg:rgba(144,144,255,0.15);--color-shadow:rgba(161, 177, 204, 0.4)}.nexmoe-post-footer{background-color:rgba(16,16,16,0)}.nexmoe-post-copyright{background-color:#ffffff78}article ul li{line-height:1.5rem!important}[data-theme=light]{--hl-color:#90a4ae!important;--hl-bg:#f6f8fa!important;--hltools-bg:#e6ebf1!important;--hltools-color:#90a4ae!important;--hlnumber-bg:#f6f8fa!important;--hlnumber-color:rgba(144, 164, 174, 0.5)!important;--hlscrollbar-bg:#dce4eb!important;--hlexpand-bg:linear-gradient(180deg, rgba(246, 248, 250, 0.1), rgba(246, 248, 250, 0.9))!important}[data-theme=dark]{--hl-color:#abb2bf!important;--hl-bg:#282c34!important;--hltools-bg:#21252b!important;--hltools-color:#bbbbbc!important;--hlnumber-bg:#282c34!important;--hlnumber-color:#495162!important;--hlscrollbar-bg:#373c47!important;--hlexpand-bg:linear-gradient(180deg, rgba(40, 44, 52, 0.1), rgba(40, 44, 52, 0.9))!important}figure.shiki{background-color:var(--hl-bg)!important;color:var(--hl-color)!important}"},{"title":"APTæºè½¬Dockerç¯å¢ƒå˜é‡è½¬æ¢å·¥å…·","date":"2024-06-22T15:00:00.000Z","updated":"2025-06-19T04:44:25.212Z","comments":true,"path":"tools/apt-converter/index.html","permalink":"https://homelabproject.cc/tools/apt-converter/index.html","excerpt":"","text":"APTæºè½¬Dockerç¯å¢ƒå˜é‡è½¬æ¢å·¥å…· å·¥å…·ä»‹ç» è¯¥å·¥å…·ç”¨äºå°†Debian/Ubuntuç³»ç»Ÿçš„APTæºåœ°å€è½¬æ¢ä¸ºDockeré•œåƒæºéƒ¨ç½²æ—¶æ‰€éœ€çš„ç¯å¢ƒå˜é‡æ ¼å¼ã€‚ ä½¿ç”¨è¯´æ˜ åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­ç²˜è´´æ‚¨çš„APTæºåœ°å€ï¼ˆæ¯è¡Œä¸€ä¸ªdebæ¡ç›®ï¼‰ ç‚¹å‡»\"è½¬æ¢\"æŒ‰é’®ï¼Œå³å¯åœ¨ä¸‹æ–¹è·å¾—è½¬æ¢åçš„ç¯å¢ƒå˜é‡ ç‚¹å‡»\"å¤åˆ¶ç»“æœ\"æŒ‰é’®å¤åˆ¶è½¬æ¢ç»“æœ æ”¯æŒçš„æ ¼å¼ æ ‡å‡†APTæºï¼šdeb https://example.com/debian bookworm main å¸¦æ¶æ„çš„APTæºï¼šdeb [arch=arm64,amd64] https://example.com/debian bookworm main å¸¦ç›®å½•çš„APTæºï¼šdeb https://example.com/debian bookworm main/debian-installer å¤šç»„ä»¶APTæºï¼šdeb https://example.com/debian bookworm main contrib non-free è¾“å…¥APTæº è½¬æ¢ åŠ è½½ç¤ºä¾‹ æ¸…ç©º è½¬æ¢ç»“æœ å¤åˆ¶ç»“æœ function convertSources() { const input = document.getElementById('apt-input').value.trim(); if (!input) { alert('è¯·è¾“å…¥APTæº'); return; } const result = parseAptSources(input); document.getElementById('apt-output').value = result; } function loadExample() { document.getElementById('apt-input').value = `# Proxmoxæ··åˆæºç¤ºä¾‹ deb [ arch=amd64,arm64,loong64 ] https://download.lierfang.com/pxcloud/pxvirt/ bookworm main deb [ arch=amd64,arm64 ] https://download.lierfang.com/pxcloud/pxvirt/ bookworm ceph-squid deb [ arch=amd64,arm64 ] https://download.lierfang.com/pxcloud/pxvirt/ bookworm ceph-reef deb [ arch=amd64 ] https://download.lierfang.com/pxcloud/pxvirt/ bookworm ceph-quincy # Tailscaleç¤ºä¾‹ deb [arch=arm64,amd64] https://pkgs.tailscale.com/stable/debian bullseye main deb [arch=arm64,amd64] https://pkgs.tailscale.com/stable/debian bookworm main`; } function clearAll() { document.getElementById('apt-input').value = ''; document.getElementById('apt-output').value = ''; } function copyResult() { const output = document.getElementById('apt-output'); if (!output.value) { alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹'); return; } output.select(); if (navigator.clipboard) { navigator.clipboard.writeText(output.value).then(() => { alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'); }).catch(() => { document.execCommand('copy'); alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'); }); } else { document.execCommand('copy'); alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'); } } function parseAptSources(input) { const lines = input.split('\\n') .map(line => line.trim()) .filter(line => line && line.startsWith('deb') && !line.startsWith('#')); if (lines.length === 0) { return 'æœªæ‰¾åˆ°æœ‰æ•ˆçš„APTæºè¡Œ'; } // æŒ‰URLåˆ†ç»„ const urlGroups = {}; lines.forEach(line => { try { const parsed = parseLine(line); if (!parsed) return; const { url, dist, components, arch } = parsed; if (!urlGroups[url]) { urlGroups[url] = []; } urlGroups[url].push({ dist, components, arch }); } catch (error) { console.warn('è§£æå¤±è´¥:', line, error); } }); // ç”Ÿæˆç¯å¢ƒå˜é‡ let result = ''; Object.keys(urlGroups).forEach(url => { result += `APTSYNC_URL=${url}\\n\\n`; const dists = urlGroups[url]; let distsStr = 'APTSYNC_DISTS='; dists.forEach((dist, index) => { if (index > 0) distsStr += ':'; // æ ¼å¼: release|component|arch|download_dir distsStr += `${dist.dist}|${dist.components}|${dist.arch}|`; }); result += distsStr + '\\n\\n'; }); return result.trim(); } function parseLine(line) { // å…ˆå¤„ç†æ¶æ„é€‰é¡¹ï¼Œç„¶åå†æŒ‰ç©ºæ ¼åˆ†å‰² let cleanLine = line.trim(); let arch = 'amd64'; // æ£€æŸ¥æ˜¯å¦æœ‰æ¶æ„é€‰é¡¹ const archMatch = cleanLine.match(/\\[\\s*arch\\s*=\\s*([^\\]]+)\\s*\\]/); if (archMatch) { arch = archMatch[1].split(',').map(a => a.trim()).join(' '); // ç§»é™¤æ¶æ„é€‰é¡¹éƒ¨åˆ† cleanLine = cleanLine.replace(/\\[\\s*arch\\s*=\\s*[^\\]]+\\s*\\]/, '').replace(/\\s+/g, ' ').trim(); } const parts = cleanLine.split(' '); if (parts[0] !== 'deb' || parts.length < 4) { return null; } const url = parts[1].replace(/\\/$/, ''); const dist = parts[2]; const components = parts.slice(3).join(' ').split('/')[0]; return { url, dist, components, arch }; }"},{"title":"","date":"2025-06-19T04:44:26.925Z","updated":"2025-06-19T04:44:26.925Z","comments":true,"path":"images/others/logdy.json","permalink":"https://homelabproject.cc/images/others/logdy.json","excerpt":"","text":"{\"name\":\"main\",\"columns\":[{\"id\":\"196505\",\"name\":\"StartLocal\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['StartLocal'] }\\n}\",\"idx\":27,\"width\":152},{\"id\":\"901886\",\"name\":\"RequestHost\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RequestHost'] }\\n}\",\"idx\":15,\"width\":144},{\"id\":\"299677\",\"name\":\"column request_X-Forwarded-Proto\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['request_X-Forwarded-Proto'] }\\n}\",\"idx\":73,\"width\":150},{\"id\":\"506966\",\"name\":\"ClientHost\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['ClientHost'] }\\n}\",\"idx\":2,\"width\":310,\"faceted\":true},{\"id\":\"807219\",\"name\":\"ClientAddr\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['ClientAddr'] }\\n}\",\"idx\":1,\"width\":150,\"hidden\":true},{\"id\":\"613622\",\"name\":\"ClientPort\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['ClientPort'] }\\n}\",\"idx\":3,\"width\":150,\"hidden\":true},{\"id\":\"533527\",\"name\":\"Verb\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RequestMethod'] }\\n}\",\"idx\":16,\"width\":61,\"hidden\":true},{\"id\":\"257448\",\"name\":\"RequestPath\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RequestPath'] }\\n}\",\"idx\":17,\"width\":283},{\"id\":\"673790\",\"name\":\"Proto\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RequestProtocol'] }\\n}\",\"idx\":19,\"width\":67},{\"id\":\"127578\",\"name\":\"Scheme\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RequestScheme'] }\\n}\",\"idx\":20,\"width\":60,\"hidden\":true},{\"id\":\"415466\",\"name\":\"RSize\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RequestContentSize'] }\\n}\",\"idx\":13,\"width\":66,\"hidden\":true},{\"id\":\"196253\",\"name\":\"DStatus\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['DownstreamStatus'] }\\n}\",\"idx\":6,\"width\":71,\"hidden\":true},{\"id\":\"227251\",\"name\":\"DSize\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['DownstreamContentSize'] }\\n}\",\"idx\":5,\"width\":84,\"hidden\":true},{\"id\":\"593531\",\"name\":\"uaURL\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['uaUrl'] }\\n}\",\"faceted\":false,\"idx\":38,\"width\":150,\"hidden\":true},{\"id\":\"536519\",\"name\":\"User Agent\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['request_User-Agent'] }\\n}\",\"idx\":33,\"width\":335},{\"id\":\"166747\",\"name\":\"Duration\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['Duration'] }\\n}\",\"idx\":7,\"width\":95},{\"id\":\"756429\",\"name\":\"Overhead\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['Overhead'] }\\n}\",\"idx\":11,\"width\":95},{\"id\":\"205334\",\"name\":\"raw\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.content || \\\"-\\\"}\\n }\",\"idx\":0,\"width\":150,\"hidden\":true},{\"id\":\"796875\",\"name\":\"ServiceName\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['ServiceName'] }\\n}\",\"idx\":24,\"width\":115},{\"id\":\"360113\",\"name\":\"OriginContentSize\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['OriginContentSize'] }\\n}\",\"idx\":8,\"width\":150,\"hidden\":true},{\"id\":\"446550\",\"name\":\"OriginDuration\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['OriginDuration'] }\\n}\",\"idx\":9,\"width\":150,\"hidden\":true},{\"id\":\"210488\",\"name\":\"OriginStatus\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['OriginStatus'] }\\n}\",\"idx\":10,\"width\":150,\"hidden\":true},{\"id\":\"654768\",\"name\":\"RequestAddr\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RequestAddr'] }\\n}\",\"idx\":12,\"width\":150,\"hidden\":true},{\"id\":\"982865\",\"name\":\"RequestCount\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RequestCount'] }\\n}\",\"idx\":14,\"width\":150,\"hidden\":true},{\"id\":\"146433\",\"name\":\"RequestPort\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RequestPort'] }\\n}\",\"idx\":18,\"width\":150,\"hidden\":true},{\"id\":\"763017\",\"name\":\"RetryAttempts\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RetryAttempts'] }\\n}\",\"idx\":21,\"width\":150,\"hidden\":true},{\"id\":\"498987\",\"name\":\"RouterName\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['RouterName'] }\\n}\",\"idx\":22,\"width\":130},{\"id\":\"671214\",\"name\":\"ServiceAddr\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['ServiceAddr'] }\\n}\",\"idx\":23,\"width\":150,\"hidden\":true},{\"id\":\"909536\",\"name\":\"ServiceURL\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['ServiceURL'] }\\n}\",\"idx\":25,\"width\":150,\"hidden\":true},{\"id\":\"857001\",\"name\":\"SpanId\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['SpanId'] }\\n}\",\"idx\":26,\"width\":150,\"hidden\":true},{\"id\":\"872847\",\"name\":\"StartUTC\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['StartUTC'] }\\n}\",\"idx\":28,\"width\":150,\"hidden\":true},{\"id\":\"275331\",\"name\":\"TraceId\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['TraceId'] }\\n}\",\"idx\":29,\"width\":150,\"hidden\":true},{\"id\":\"933666\",\"name\":\"entryPointName\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['entryPointName'] }\\n}\",\"idx\":30,\"width\":150},{\"id\":\"349392\",\"name\":\"level\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['level'] }\\n}\",\"idx\":31,\"width\":150,\"hidden\":true},{\"id\":\"138481\",\"name\":\"msg\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['msg'] }\\n}\",\"idx\":32,\"width\":150,\"hidden\":true},{\"id\":\"562160\",\"name\":\"time\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['time'] }\\n}\",\"idx\":34,\"width\":150,\"hidden\":true},{\"id\":\"483561\",\"name\":\"hostname\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['hostname'] }\\n}\",\"faceted\":true,\"idx\":34,\"width\":150,\"hidden\":true},{\"id\":\"090942\",\"name\":\"subdomain\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['subdomain'] }\\n}\",\"faceted\":true,\"idx\":35,\"width\":150,\"hidden\":true},{\"id\":\"837141\",\"name\":\"external\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['external'] }\\n}\",\"faceted\":true,\"idx\":36,\"width\":150,\"hidden\":true},{\"id\":\"612490\",\"name\":\"me\",\"handlerTsCode\":\"(line: Message): CellHandler => {\\n return { text: line.json_content['me'] }\\n}\",\"faceted\":true,\"idx\":37,\"width\":150,\"hidden\":true}],\"settings\":{\"leftColWidth\":300,\"drawerColWidth\":900,\"maxMessages\":1000,\"middlewares\":[{\"id\":\"m_632328\",\"name\":\"additional_info\",\"handlerTsCode\":\"(line: Message): Message | void => {\\n\\n let external = true;\\n let me = false;\\n\\n const client = line.json_content.ClientHost;\\n const host = line.json_content.RequestHost;\\n const uaString = line.json_content['request_User-Agent'];\\n\\n external = !client.includes('192.168.0') && client !== \\\"2600:1700:1e1f:YOUR:IPV6\\\";\\n me = client === \\\"192.168.TREFIK_EXTERNAL.HOST_CHANGEME\\\" || client === \\\"2600:1700:1e1f:YOUR:IPV6CHANGME\\\"\\n\\n const urlPattern = /^(?:([A-Za-z]+?):\\\\/\\\\/)?(?:[^@\\\\n]+@)?(?:([A-Za-z]+?)\\\\.)?([^:\\\\/\\\\n?]+)(.*)/;\\n\\n let hostname = '-',\\n subdomain = '-',\\n uaUrl;\\n\\n if (host !== '-') {\\n\\n const urlMatch = host.match(urlPattern);\\n\\n if (urlMatch) {\\n if (urlMatch[3].includes('.')) {\\n subdomain = urlMatch[2];\\n hostname = urlMatch[3];\\n } else {\\n hostname = `${urlMatch[2]}.${urlMatch[3]}`;\\n }\\n if (external && hostname === \\\"CHANGEME.casa\\\") {\\n external = false;\\n }\\n }\\n }\\n\\n const regUrlPattern = /\\\\+([(http(s)?):\\\\/\\\\/(www\\\\.)?a-zA-Z0-9@:%._\\\\+~#=]{2,256}\\\\.[a-z]{2,20}\\\\b([-a-zA-Z0-9@:%_\\\\+.~#?&//=]*))/;\\n const uaMatch = uaString.match(regUrlPattern);\\n if (uaMatch) {\\n uaUrl = uaMatch[1];\\n }\\n\\n line.json_content.subdomain = subdomain;\\n line.json_content.hostname = hostname;\\n line.json_content.external = external;\\n line.json_content.me = me;\\n line.json_content.uaUrl = uaUrl;\\n\\n return line;\\n}\"}],\"entriesOrder\":\"desc\"}}"}],"posts":[{"title":"TrueNAS Grafana ç›‘æ§æ•™ç¨‹ graphite exporter","slug":"TrueNAS/TrueNAS Grafana ç›‘æ§æ•™ç¨‹ graphite exporter","date":"2025-06-18T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"TrueNAS/TrueNAS Grafana ç›‘æ§æ•™ç¨‹ graphite exporter/","permalink":"https://homelabproject.cc/TrueNAS/TrueNAS%20Grafana%20%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B%20graphite%20exporter/","excerpt":"","text":"æ¥æº https://github.com/Supporterino/truenas-graphite-to-prometheus è¿˜æ˜¯å»ºè®®è‡ªå·±çœ‹æ–‡æ¡£ PSï¼š25.04çš„å®˜æ–¹exporterå…³é—­äº†å¾ˆå¤šä¿¡æ¯ï¼Œæ‰€ä»¥é‡‡é›†ä¸å…¨ï¼Œæ¯”å¦‚å†…å­˜å’ŒDiskä¿¡æ¯ã€‚ ä»‹ç» é¦–å…ˆéœ€è¦ä¸ªGrafanaç›‘æ§ï¼Œä¸»è¦æ˜¯Grafanaä¸Šçœ‹ä¸€åˆ‡æ–¹ä¾¿ç‚¹ã€‚ åŸç† å®˜æ–¹ç”¨Netdataï¼Œæ—©æœŸè¿˜ç›´æ¥æä¾›netdataé¢æ¿ï¼Œä¸ºäº†&quot;å®‰å…¨&quot;ï¼Œç°åœ¨åªæœ‰exporterï¼ŒåŒæ—¶æ˜¯GRAPHITEçš„ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸ªGraphiteåˆ°Prometheusçš„è½¬æ¢ï¼Œæ¥æºçš„é“¾æ¥ç»™ä½ åšå¥½äº†ã€‚ éƒ¨ç½² Graphite-Prometheusçš„è½¬æ¢ Docker æ²¡ä»€ä¹ˆè¦è¯´çš„ï¼Œè¿™é‡Œæˆ‘ç”¨çš„39109è¿æ¥TrueNSA ï¼Œ39108æ˜¯ç»™prometheusè¿æ¥çš„ 12345678services: ts-graphite-prometheus: image: ghcr.io/supporterino/truenas-graphite-to-prometheus ports: #to graphite - 39109:9109 #to prometheus - 39108:9108 TrueNAS exporterè®¾ç½® å¦‚ä¸‹ï¼Œè¦æ³¨æ„çš„æ˜¯ Destination IPå’ŒPortæ˜¯ä½ éƒ¨ç½²ä¸Šé¢é‚£ä¸ªDockerçš„IPå’Œto graphiteçš„Portã€‚ Perfixæ³¨æ„æ˜¯truenasä¸èƒ½æ”¹ Namespaceéšæ„ å…¶ä»–ç…§æŠ„ éƒ¨ç½²Grafanaå’ŒPrometheus ç½‘ä¸Šåˆ°å¤„éƒ½æ˜¯ï¼Œæˆ‘éšä¾¿ç»™ä¸ªä¾‹å­ é¦–å…ˆæ˜¯éƒ¨ç½² 12345678910111213141516171819202122232425services: prometheus: image: prom/prometheus container_name: prometheus ports: - 58474:9090 networks: - monitor volumes: - $DOCKER_DATA/prometheus/config:/etc/prometheus command: - --config.file=/etc/prometheus/prometheus.yml restart: always grafana-oss: container_name: grafana restart: always networks: - monitor ports: - 38533:3000 volumes: - $DOCKER_DATA/grafana/config:/var/lib/grafana image: grafana/grafana-oss networks: - monitor ç„¶åä½ éœ€è¦å»ä¿®æ”¹Prometheusçš„é…ç½®ï¼Œä½ ä¸Šé¢åˆ›å»ºå®Œæ²¡é…ç½®ä¹Ÿä¼šæç¤ºæŠ¥é”™ æˆ‘çš„è·¯å¾„åœ¨$DOCKER_DATA/prometheus/config/prometheus.ymlï¼Œä½ ä»¬çš„è‡ªå·±çœ‹ç€æ›¿æ¢ æœ€åè¦åŠ ä¸ªTruenasçš„jobï¼Œtargetséœ€è¦ä¿®æ”¹æˆä¸Šé¢éƒ¨ç½²é‚£ä¸ªDockerçš„IPå’Œto Prometheusçš„Portã€‚ 123456789101112global: scrape_interval: 15s # By default, scrape targets every 15 seconds. scrape_configs: - job_name: &#39;prometheus&#39; scrape_interval: 5s static_configs: - targets: [&#39;localhost:9090&#39;] - job_name: &#39;truenas&#39; scrape_interval: 1s static_configs: - targets: [&#39;10.1.10.5:39108&#39;] é‡å¯ä¸€ä¸‹ä½ çš„Prometheusã€‚ Grafanaæ·»åŠ æ•°æ®æºå’Œé¢æ¿ æ•°æ®æºï¼š Connection - Data sources - Add New data source - é€‰æ‹© Prometheus - åœ¨Prometheus server URLé‡Œå¡«å…¥http://prometheus:9090- åˆ°æœ€åSave $ test å³å¯ ` é¢æ¿ï¼š é¦–å…ˆé€‰æ‹©ä½ çš„é¢æ¿ https://github.com/Supporterino/truenas-graphite-to-prometheus/tree/main/dashboards æ­£å¸¸ç›´æ¥ç”¨truenas_scale.jsonï¼Œå¤åˆ¶é‡Œé¢å†…å®¹ Dashboard - New - Import - åœ¨Import via dashboard JSON modelé‡Œ ç²˜è´´ - Load - Mimiré‡Œé¢é€‰ä½ åˆšåˆšåˆ›å»ºçš„æ•°æ®æºï¼Œå°±è¡Œäº†ã€‚","categories":[],"tags":[{"name":"SelfHosted","slug":"SelfHosted","permalink":"https://homelabproject.cc/tags/SelfHosted/"},{"name":"TrueNAS","slug":"TrueNAS","permalink":"https://homelabproject.cc/tags/TrueNAS/"}]},{"title":"Tinyauth è‡ªæ‰˜ç®¡ èº«ä»½éªŒè¯ ä¸­é—´ä»¶","slug":"Container/Tinyauth è‡ªæ‰˜ç®¡ èº«ä»½éªŒè¯ ä¸­é—´ä»¶","date":"2025-06-06T15:00:00.000Z","updated":"2025-06-19T04:44:26.917Z","comments":true,"path":"Container/Tinyauth è‡ªæ‰˜ç®¡ èº«ä»½éªŒè¯ ä¸­é—´ä»¶/","permalink":"https://homelabproject.cc/Container/Tinyauth%20%E8%87%AA%E6%89%98%E7%AE%A1%20%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%20%E4%B8%AD%E9%97%B4%E4%BB%B6/","excerpt":"","text":"Source &amp;&amp; Doc https://github.com/steveiliop56/tinyauth?tab=readme-ov-file https://tinyauth.app/docs/about.html å¼ºçƒˆå»ºè®®é˜…è¯»ï¼Œæ­¤æ–‡ç« åªæ˜¯ä¸ªæ¨èï¼Œé‡å¤é€ è½®å­ ä»‹ç» é¦–å…ˆè¯´ä¸€ä¸‹éœ€æ±‚ï¼Œåœ¨Selfhost ç¼ºå°‘èº«ä»½éªŒè¯æˆ–è€…æ˜¯ç±»ä¼¼PHPç­‰è¿™ç§å¾ˆå®¹æ˜“å­˜åœ¨æ¼æ´åº”ç”¨ï¼Œéœ€è¦å¤šä¸€å±‚éªŒè¯ï¼ˆå½“ç„¶æœ€ä½³å®è·µåº”è¯¥æ˜¯ç›´æ¥ä½¿ç”¨VPNå†…éƒ¨è®¿é—®ï¼Œä¸å…¬å¼€åˆ°å…¬ç½‘ï¼Œä½†æ˜¯æœ‰äº›åº”ç”¨è¿˜æ˜¯å­˜åœ¨è¿™ç§ä½¿ç”¨åœºæ™¯ï¼‰ã€‚ æœ¬èº«å…¶å®æœ‰å¤§é‡çš„èº«ä»½éªŒè¯åº”ç”¨æ¯”å¦‚Authelia/Authentik/Keycloackä¹‹ç±»ã€‚ åŸå› 1 å¤§éƒ¨åˆ†è¿™äº›å·¥å…·ä¸ºäº†ä¼ä¸šçº§ç”Ÿäº§åŠ›éœ€æ±‚ä¼šååˆ†å¤æ‚ã€‚æ¯”å¦‚ä¹‹å‰ä½¿ç”¨çš„Authentikï¼Œä»–çš„composeéœ€è¦ç®€ç®€å•å•147è¡Œï¼ˆ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142services: authentik-postgresql: image: docker.io/library/postgres:16-alpine restart: unless-stopped healthcheck: test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -d $${POSTGRES_DB} -U $${POSTGRES_USER}&quot;] start_period: 20s interval: 30s retries: 5 timeout: 5s volumes: - ./database:/var/lib/postgresql/data environment: POSTGRES_PASSWORD: ${PG_PASS:?database password required} POSTGRES_USER: ${PG_USER:-authentik} POSTGRES_DB: ${PG_DB:-authentik} env_file: - .env networks: - default authentik-redis: image: docker.io/library/redis:alpine command: --save 60 1 --loglevel warning restart: unless-stopped healthcheck: test: [&quot;CMD-SHELL&quot;, &quot;redis-cli ping | grep PONG&quot;] start_period: 20s interval: 30s retries: 5 timeout: 3s volumes: - redis_authentik:/data networks: - default authentik-server: image: ${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG} restart: unless-stopped command: server environment: AUTHENTIK_REDIS__HOST: authentik-redis AUTHENTIK_POSTGRESQL__HOST: authentik-postgresql AUTHENTIK_POSTGRESQL__USER: ${PG_USER:-authentik} AUTHENTIK_POSTGRESQL__NAME: ${PG_DB:-authentik} AUTHENTIK_POSTGRESQL__PASSWORD: ${PG_PASS} volumes: - ./authentik/media:/media - ./authentik/custom-templates:/templates # - /var/run/docker.sock:/var/run/docker.sock env_file: - .env # ports: # - &quot;${COMPOSE_PORT_HTTP:-9000}:9000&quot; # - &quot;${COMPOSE_PORT_HTTPS:-9443}:9443&quot; networks: - public_web - default depends_on: authentik-postgresql: condition: service_healthy authentik-redis: condition: service_healthy labels: homepage.group: Networking homepage.name: Authentik homepage.icon: authentik homepage.href: &quot;https://auth.CHANGEME.com&quot; traefik.enable: true traefik.http.routers.authentik.rule: Host(`auth.CHANGEME.com`) traefik.http.services.authentik.loadbalancer.server.port: 9000 traefik.docker.network: public_web traefik.public: true authentik-proxy: image: ghcr.io/goauthentik/proxy:${AUTHENTIK_TAG:-2024.10.5} # ports: # - 9000:9000 # - 9443:9443 networks: - public_web - default environment: AUTHENTIK_REDIS__HOST: authentik-redis AUTHENTIK_HOST: http://authentik-server:9000 AUTHENTIK_INSECURE: &quot;true&quot; AUTHENTIK_TOKEN: ${AUTHENTIK_TRAEFIK_EXT_OUTPOST_TOKEN} # Starting with 2021.9, you can optionally set this too # when authentik_host for internal communication doesn&#39;t match the public URL AUTHENTIK_HOST_BROWSER: https://auth.CHANGEME.com # for logging edit log_level in outpost config from ui labels: traefik.enable: true traefik.port: 9000 traefik.http.routers.authentik-proxy.rule: Host(`CHANGEME.com`) &amp;&amp; PathPrefix(`/outpost.goauthentik.io/`) # `authentik-proxy` refers to the service name in the compose file. traefik.http.middlewares.authentik-proxy.forwardauth.address: http://authentik-proxy:9000/outpost.goauthentik.io/auth/traefik traefik.http.middlewares.authentik-proxy.forwardauth.trustForwardHeader: true traefik.http.middlewares.authentik-proxy.forwardauth.authResponseHeaders: X-authentik-username,X-authentik-groups,X-authentik-entitlements,X-authentik-email,X-authentik-name,X-authentik-uid,X-authentik-jwt,X-authentik-meta-jwks,X-authentik-meta-outpost,X-authentik-meta-provider,X-authentik-meta-app,X-authentik-meta-version traefik.public: true kop.namespace: none restart: unless-stopped worker: image: ${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG:-2024.10.5} restart: unless-stopped command: worker environment: AUTHENTIK_REDIS__HOST: authentik-redis AUTHENTIK_POSTGRESQL__HOST: authentik-postgresql AUTHENTIK_POSTGRESQL__USER: ${PG_USER:-authentik} AUTHENTIK_POSTGRESQL__NAME: ${PG_DB:-authentik} AUTHENTIK_POSTGRESQL__PASSWORD: ${PG_PASS} # `user: root` and the docker socket volume are optional. # See more for the docker socket integration here: # https://goauthentik.io/docs/outposts/integrations/docker # Removing `user: root` also prevents the worker from fixing the permissions # on the mounted folders, so when removing this make sure the folders have the correct UID/GID # (1000:1000 by default) user: root volumes: - /var/run/docker.sock:/var/run/docker.sock - ./authentik/media:/media - ./authentik/certs:/certs - ./authentik/custom-templates:/templates env_file: - .env depends_on: authentik-postgresql: condition: service_healthy authentik-redis: condition: service_healthy networks: - default networks: default: internal: true public_web: external: true volumes: redis_authentik: driver: local åŸå› 2 æœ€è¿‘æŠŠå®¶é‡Œçš„æ¶æ„ç”±Nginxæ‰‹åŠ¨åˆ›å»ºå˜æˆäº†Compose + Traefikï¼Œç°åœ¨æˆ‘åˆ›å»ºä¸€ä¸ªæœåŠ¡çš„åå‘ä»£ç†ï¼Œåªéœ€è¦å‘ä¸‹é¢è¿™æ ·ï¼Œåœ¨docker composeï¼Œåå‘ä»£ç†å°†è‡ªåŠ¨åŒ–ç”Ÿæˆã€‚æ‰€ä»¥æ”¯æŒé€šè¿‡labelsæè¿°ï¼Œå¹¶ä¸”è‡ªåŠ¨åŠ è½½ 1234567891011121314151617labels: traefik.enable: true traefik.public: true traefik.docker.network: traefik_external_public_web #----- traefik.http.routers.hlpj-alist.rule: Host(`alist.homelabproject.cc`)||Host(`file.homelabproject.cc`) traefik.http.routers.hlpj-alist.entrypoints: cf traefik.http.services.hlpj-alist.loadbalancer.server.port: 5244 traefik.http.routers.hlpj-alist.service: hlpj-alist #---cloudflared--- cloudflare.tunnel.enable: &quot;true&quot; cloudflare.tunnel.0.hostname: alist.homelabproject.cc cloudflare.tunnel.0.service: http://traefik:808 cloudflare.tunnel.0.zonename: homelabproject.cc cloudflare.tunnel.1.hostname: file.homelabproject.cc cloudflare.tunnel.1.service: http://traefik:808 cloudflare.tunnel.1.zonename: homelabproject.cc é…ç½® åŸºç¡€å®¹å™¨ é¦–å…ˆä½ éœ€è¦æœ€åŸºç¡€3ä¸ªæ¡ä»¶ SECERTå˜é‡ ç›´æ¥åœ¨å‘½ä»¤è¡Œè¡Œéšæœºç”Ÿæˆä¸€ä¸ª32å­—èŠ‚çš„éšæœºå¯†é’¥ 1openssl rand -base64 32 | tr -dc &#39;a-zA-Z0-9&#39; | head -c 32 USERS ä½ çš„ç”¨æˆ·åå¯†ç ï¼Œå‘½ä»¤è¡Œè¾“å…¥ä¸‹é¢ï¼Œä¼šè¿›å…¥äº¤äº’ï¼Œè®°å¾—åœ¨é—®ä½ æ˜¯å¦ä½¿ç”¨dockerçš„æ—¶å€™é€‰æ‹©yes 1docker run -i -t --rm ghcr.io/steveiliop56/tinyauth:v3 user create --interactive ä½ å°±ä¼šå¾—åˆ°è½¬æ¢å®Œç”¨äºç™»é™†çš„è´¦å·å¯†ç çš„bcrypt å“ˆå¸Œã€‚å¦‚æœä½ æœ‰å¤šä¸ªè´¦å·å¯†ç ç”¨,éš”å¼€ ç”¨äºéªŒè¯çš„åŸŸå tinyauthçš„è®¿é—®æµç¨‹ï¼šå½“ä½ è®¿é—®éœ€è¦èº«ä»½éªŒè¯çš„åŸŸåï¼Œä»–ä¼šè½¬æ¡åˆ°tinyauth.ä½ çš„åŸŸå.coméªŒè¯è´¦å·å¯†ç ï¼Œç„¶åä½ å†å›åˆ°ä½ æœåŠ¡çš„åŸŸåå°±èƒ½æ­£å¸¸è®¿é—®äº†ã€‚ æ‰€ä»¥éœ€è¦æå‰é…ç½®å¥½ä½ çš„åŸŸå æœ€åï¼Œé…ç½®ä½ ä¸‹é¢çš„ç¯å¢ƒå˜é‡ï¼Œå¯åŠ¨å³å¯ 123456789101112tinyauth: image: ghcr.io/steveiliop56/tinyauth:v3 container_name: tinyauth restart: unless-stopped environment: - SECRET=some-random-32-chars-string - APP_URL=https://tinyauth.ä½ çš„åŸŸå.com - USERS=your-username-password-hash labels: traefik.enable: true traefik.http.routers.tinyauth.rule: Host(`tinyauth.ä½ çš„åŸŸå.com`) traefik.http.middlewares.tinyauth.forwardauth.address: http://tinyauth:3000/api/auth/traefik é…ç½®éœ€è¦éªŒè¯çš„åº”ç”¨ ä½ åªéœ€è¦é™„å¸¦Labelï¼Œæ·»åŠ Routerçš„ä¸­é—´ä»¶ï¼Œå³å¯è®¿é—® 12labels: traefik.http.routers.[ä½ çš„æœåŠ¡].middlewares: tinyauth@docker æ€»ç»“ tinyauthçš„ç›®çš„æœ¬èº«å°±ä¸æ˜¯ä¸ºäº†ç”Ÿäº§åŠ›ï¼Œå¯¹äºHomelabæ¥è¯´å°±æ˜¯ç®€æ´é«˜æ•ˆï¼Œä¸ªäººè§‰å¾—è¿˜æ˜¯æŒºå¥½ç”¨ã€‚","categories":[],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://homelabproject.cc/tags/Docker/"},{"name":"SelfHosted","slug":"SelfHosted","permalink":"https://homelabproject.cc/tags/SelfHosted/"},{"name":"Infra","slug":"Infra","permalink":"https://homelabproject.cc/tags/Infra/"}]},{"title":"Hexo Blogæ–¹æ¡ˆ","slug":"Infra/Hexo Blogæ–¹æ¡ˆ","date":"2025-05-29T15:00:00.000Z","updated":"2025-06-19T04:44:26.917Z","comments":true,"path":"Infra/Hexo Blogæ–¹æ¡ˆ/","permalink":"https://homelabproject.cc/Infra/Hexo%20Blog%E6%96%B9%E6%A1%88/","excerpt":"","text":"æ‹†åˆ†Postsè·¯å¾„åˆ°å•ç‹¬Branchï¼ŒObsidianæŒ‚Posts Branchï¼Œæœ¬åœ°Markdownåªæœ‰æ–‡ç« éƒ¨åˆ†ï¼Œå†™å®Œç›´æ¥æ¨é€è§¦å‘ç¼–è¯‘ æœ¬åœ°Gitea Actionç¼–è¯‘-&gt;åªæ¨é€é™æ€èµ„æºåˆ°Github Vercelæ‰˜ç®¡ï¼Œå¯ä»¥äº«å—è¾ƒå¿«çš„å›½å†…çš„è®¿é—®é€Ÿåº¦ï¼Œæ„Ÿè°¢ä¸‹é¢é¡¹ç›®æä¾›ä¼˜è´¨cnameè§£æ https://github.com/xingpingcn/enhanced-FaaS-in-China Gitea Workflow 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374name: Build Hexo Blog on: push: branches: - posts # This workflow will be triggered when pushing to posts branch workflow_dispatch: # Allow manual trigger jobs: build: runs-on: ubuntu-latest steps: - name: Checkout repository uses: actions/checkout@v4 with: fetch-depth: 0 # Fetch all history for all branches - name: Setup Node.js uses: actions/setup-node@v4 with: node-version: &#39;20&#39; # - name: Clean posts directory # run: | # rm -rf source/* - name: Copy posts run: | # è·å–postsåˆ†æ”¯ git fetch origin posts:posts # åˆ›å»ºä¸´æ—¶ç›®å½• mkdir -p temp_posts cd temp_posts # æ£€å‡ºpostsåˆ†æ”¯çš„å†…å®¹ git --git-dir=../.git --work-tree=. checkout posts -- . # å¤åˆ¶æ‰€æœ‰æ–‡ä»¶åˆ°source/ cp -r * ../source/ cd .. # æ¸…ç†ä¸´æ—¶ç›®å½• rm -rf temp_posts - name: Install dependencies run: npm install - name: Build Hexo site run: npx hexo generate - name: Push to GitHub env: HLPJTOKEN: ${{ secrets.HLPJTOKEN }} ACTOR: ${{ vars.GITHUBACTOR }} REPOSITORY: ${{ vars.GITHUBREPOSITORY }} run: | # å…‹éš†ç›®æ ‡ä»“åº“ git clone &quot;https://${ACTOR}:${HLPJTOKEN}@github.com/${REPOSITORY}.git&quot; temp_deploy cd temp_deploy # æ¸…ç©ºä»“åº“å†…å®¹ï¼ˆä¿ç•™.gitç›®å½•ï¼‰ find . -mindepth 1 -maxdepth 1 ! -name &#39;.git&#39; -exec rm -rf {} + # å¤åˆ¶æ–°ç”Ÿæˆçš„æ–‡ä»¶ cp -r ../public/* . # é…ç½®git git config user.name &quot;${ACTOR}&quot; git config user.email &quot;${ACTOR}@users.noreply.github.com&quot; # æ·»åŠ æ‰€æœ‰æ–‡ä»¶å¹¶æäº¤ git add -A git commit -m &quot;Build: Update site content&quot; # æ¨é€åˆ°mainåˆ†æ”¯ git push origin HEAD:main","categories":[],"tags":[{"name":"Infra","slug":"Infra","permalink":"https://homelabproject.cc/tags/Infra/"}]},{"title":"è‡ªå»º APT é•œåƒæº æ•™ç¨‹ Tunasync CRONå®šæ—¶ å¤šçº¿ç¨‹","slug":"Infra/è‡ªå»º APT é•œåƒæº æ•™ç¨‹ Tunasync CRONå®šæ—¶ å¤šçº¿ç¨‹","date":"2025-05-27T15:00:00.000Z","updated":"2025-06-19T04:44:26.917Z","comments":true,"path":"Infra/è‡ªå»º APT é•œåƒæº æ•™ç¨‹ Tunasync CRONå®šæ—¶ å¤šçº¿ç¨‹/","permalink":"https://homelabproject.cc/Infra/%E8%87%AA%E5%BB%BA%20APT%20%E9%95%9C%E5%83%8F%E6%BA%90%20%E6%95%99%E7%A8%8B%20Tunasync%20CRON%E5%AE%9A%E6%97%B6%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/","excerpt":"","text":"æºç  Githubå·²ç»å‘å¸ƒï¼ŒREADMEåŒ…å«å¤§éƒ¨åˆ†è¯´æ˜ https://github.com/ChanningHe/tunasync-docker è‡ªå»ºåŸå›  å®¶é‡Œçš„æœåŠ¡å™¨è¶Šæ¥è¶Šå¤šï¼ŒåŸºç¡€é•œåƒæ¯”å¦‚Debianä¹‹ç±»çš„éœ€è¦ä¸€ä¸ªé•œåƒï¼Œæ–¹ä¾¿æœ¬åœ°å¿«é€Ÿæ‹‰å–ã€‚ ProxmoxVEçš„éè®¢é˜…æºç”¨æˆ·äººæ•°å¤šï¼Œè¿˜æ˜¯ç”¨èµ·æ¥ä¸æ˜¯é‚£ä¹ˆå¿«ï¼ŒåŠ ä¸Šé›†ç¾¤æœºå™¨å¤šã€‚ TrueNASç¼–è¯‘çš„æ—¶å€™ä¸¥é‡ä¾èµ–ä»–ä»¬çš„APTæºï¼Œä»–ä»¬çš„APTæºåˆå¥‡æ…¢ï¼ŒåŠ è½½åªæœ‰å‡ ç™¾KB/sï¼Œæ¢å®Œæœ¬åœ°åç¼–è¯‘ä»2h+å˜æˆ1h+ï¼Œæ„ŸçŸ¥è¿˜æ˜¯æ˜æ˜¾çš„ã€‚ Tailscaleæºè¿˜æ˜¯å›½å†…è®¿é—®ååˆ†æ…¢çš„æºï¼Œç”¨çš„æœºå™¨é•œåƒæ‹‰ä¸ä¸‹æ¥ï¼Œå¾ˆå¤šæ ¡å›­æºåˆä¸åšå•†ä¸šè½¯ä»¶çš„æºã€‚ Composeç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960services: mirrors-nginx: image: nginx:latest container_name: mirrors-nginx ports: - &quot;[Node-Port]:80&quot; volumes: - $DOCKER_DATA/mirrors-nginx/nginx:/etc/nginx/conf.d - $DOCKER_DATA/mirrors-data:/mnt/Kiwi/Mirror/mirrors-data restart: always aptsync-proxmox: environment: - PUID=[CHANGE-UID] - PGID=[CHANGE-GID] - APTSYNC_UNLINK=1 - APTSYNC_URL=http://download.proxmox.com/debian/pve - APTSYNC_DISTS=bookworm|pve-no-subscription|amd64| - CRON=20 23,6,12,20 * * * - TO=/data volumes: - $DOCKER_DATA/mirrors-data/proxmox:/data - $DOCKER_DATA/mirrors-logs/aptsync-proxmox:/log - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro image: channinghe/apt-sync:aria2c aptsync-tailscale: environment: - PUID=[CHANGE-UID] - PGID=[CHANGE-GID] - APTSYNC_UNLINK=1 - APTSYNC_URL=https://pkgs.tailscale.com/stable/debian - APTSYNC_DISTS=bookworm|main|arm64 amd64|:bullseye|main|arm64 amd64| - CRON=20 23,6,12,18 * * * - TO=/data volumes: - $DOCKER_DATA/mirrors-data/tailscale:/data - $DOCKER_DATA/mirrors-logs/tailscale:/log - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro image: channinghe/apt-sync:aria2c aptsync-debian: environment: - PUID=[CHANGE-UID] - PGID=[CHANGE-GID] - APTSYNC_UNLINK=1 - APTSYNC_URL=http://deb.debian.org/debian - APTSYNC_DISTS=bookworm|main contrib non-free non-free-firmware|amd64 arm64|:bullseye|main contrib non-free|amd64 arm64| - CRON=&quot;0 0,6,12,18 * * *&quot; - TO=/data # ä¸‹è½½çº¿ç¨‹æ•° - PARALLEL_DOWNLOADS=8 volumes: - $DOCKER_DATA/mirrors-data/debian:/data - $DOCKER_DATA/mirrors-logs/aptsync-debian:/log image: channinghe/apt-sync:aria2c networks: {} Nginx Nginxçš„ç›®çš„æ˜¯å…¬å¼€ç½‘é¡µï¼Œéœ€è¦å¦å¤–å¢åŠ é…ç½®/etc/nginx/conf.d/default.conf(å®¹å™¨å†…åœ°å€) æˆ–è€…æ˜¯$DOCKER_DATA/mirrors-nginx/nginx/default.conf(ä¸»æœºåœ°å€) 1234567location / { #ä½ æŒ‚è½½è¿›å»çš„apté•œåƒæ•°æ®çš„åœ°æ–¹å¿— alias $DOCKER_DATA/mirrors-data/; autoindex on; autoindex_exact_size off; autoindex_localtime on; } ç¯å¢ƒå˜é‡ å˜é‡å æè¿° APTSYNC_URL ä¸Šæ¸¸é•œåƒURL APTSYNC_DISTS éœ€è¦åŒæ­¥çš„å‘è¡Œç‰ˆé…ç½®ï¼Œæ ¼å¼ä¸ºï¼šå‘è¡Œç‰ˆ|ç»„ä»¶|æ¶æ„|ä¸‹è½½è·¯å¾„ APTSYNC_UNLINK æ˜¯å¦å…ˆåˆ é™¤ç›®æ ‡æ–‡ä»¶ï¼Œè®¾ç½®ä¸º1å¼€å¯ APTSYNC_DISTSï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å·¥å…·æ‰¹é‡è½¬æ¢ ğŸ”„ APTæºè½¬æ¢å·¥å…· å°†Debian/Ubuntuçš„APTæºåœ°å€è½¬æ¢ä¸ºDockeré•œåƒæºéƒ¨ç½²ç¯å¢ƒå˜é‡ è‡ªå»ºæºåœ°å€ https://mirrors.homelabproject.cc/ ï¼ˆåªæ˜¯åšä¸ªç¤ºä¾‹ï¼Œåœ¨Cloudflare CDNå‰åªæ˜¯å…¬å¼€å›¾ä¸€ä¹ï¼‰ .tools-container { max-width: 800px; margin: 0 auto; padding: 20px; } .tools-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; } .tool-card { display: block; padding: 20px; border-radius: 8px; background-color: var(--color-card); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); transition: transform 0.2s, box-shadow 0.2s; text-decoration: none; color: var(--color-text); } .tool-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15); } .tool-icon { font-size: 2.5rem; margin-bottom: 15px; } .tool-card h3 { margin: 0 0 10px 0; font-size: 1.2rem; } .tool-card p { margin: 0; font-size: 0.9rem; opacity: 0.8; } @media (max-width: 600px) { .tools-grid { grid-template-columns: 1fr; } }","categories":[],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://homelabproject.cc/tags/Docker/"},{"name":"Infra","slug":"Infra","permalink":"https://homelabproject.cc/tags/Infra/"},{"name":"Others","slug":"Others","permalink":"https://homelabproject.cc/tags/Others/"}]},{"title":"TrueNAS 25.04 Dockeræœ€ä½³å®è·µï¼ˆæ–‡ä»¶æƒé™ç¯‡ï¼‰","slug":"TrueNAS/TrueNAS 25.04  Dockeræœ€ä½³å®è·µï¼ˆæ–‡ä»¶æƒé™UIDç¯‡ï¼‰","date":"2025-05-24T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"TrueNAS/TrueNAS 25.04  Dockeræœ€ä½³å®è·µï¼ˆæ–‡ä»¶æƒé™UIDç¯‡ï¼‰/","permalink":"https://homelabproject.cc/TrueNAS/TrueNAS%2025.04%20%20Docker%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%EF%BC%88%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90UID%E7%AF%87%EF%BC%89/","excerpt":"","text":"ä»‹ç» TrueNAS SCALE 24.10ä»K8sçš„æ”¯æŒè½¬åˆ°äº†æ›´å¥½çš„ç»´æŠ¤çš„Dockerï¼ˆä¸­é—´ä»·éœ€è¦è°ƒç”¨çš„ä¸œè¥¿å¤ªå¤šäº†ï¼‰ï¼ŒåŸºæœ¬ä¸Šå‘Šåˆ«SCALEè¿™ä¸ªè¯ï¼ˆè¿™ä¹Ÿå°±æ˜¯25.04å·²ç»ä¸å«SCALEçš„åŸå› ï¼‰ã€‚ Dockeræœ¬èº«å¯¹äºåº”ç”¨çš„éƒ¨ç½²éš¾åº¦æ˜¯å¤§å¹…é™åº¦çš„ï¼Œä½†æ˜¯Dockeréš¾åº¦çš„é™ä½å…¶å®æ˜¯æœ‰æ˜æ˜¾ä»£ä»·çš„ï¼Œå°±æ˜¯æƒé™é—®é¢˜ã€‚ è¿™ç‰‡æ–‡ç« ç›®çš„åœ¨äºåˆ†æå½“å‰Dockeré•œåƒå¸¦æ¥çš„å„ç§é—®é¢˜ è™½ç„¶å®åœ¨TrueNAS 25.04è¿è¡Œï¼Œä½†æ˜¯ç†è®ºåœ¨ä»»ä½•ç³»ç»Ÿéƒ½é€šç”¨ï¼Œéƒ½å¯ä»¥ä½œä¸ºdockerè¿è¡Œçš„ä¸€ä¸ª ç›®çš„ å®‰å…¨ç¬¬ä¸€ å› ä¸ºæœ‰å¯¹å¤–æœåŠ¡ï¼Œè¦ä¿è¯å®¹å™¨å³ä½¿è¢«é€ƒé€¸ä¹Ÿä¸ä¼šå¾—åˆ°hostçš„rootæƒé™ æŒ‚è½½ç›®å½•æƒé™ç»Ÿä¸€ æ‰€æœ‰çš„dockerå®¹å™¨åº”ç”¨æœ€åéƒ½å±äºä¸€ä¸ªUIDæˆ–è€…GIDï¼Œæ–¹ä¾¿æƒé™ç®¡ç† æ€§èƒ½ é€ƒä¸å¼€çš„è¯é¢˜ï¼Œè™½ç„¶æœ‰nfs over rdmaèƒ½é™ä½æŒ‚ç»™å…¶ä»–è™šæ‹ŸæœºæŸè€—ï¼Œä½†æ˜¯æœ¬èº«zfså¯¹äºnvmeæ€§èƒ½çš„æŸè€—å·²ç»ååˆ†å¤§ï¼Œèƒ½é€šè¿‡ç›´æ¥æŒ‚è½½ç›®å½•è€Œéç½‘ç»œæŒ‚è½½ï¼Œåœ¨CPUï¼Œç£ç›˜ç­‰æ–¹é¢çš„æ¶ˆè€—ä¹Ÿèƒ½å‡å°‘ã€‚åŒæ—¶åœ¨hostç®¡ç†ç›®å½•ä¹Ÿæ›´åŠ æ–¹ä¾¿ã€‚ é—®é¢˜ Docker Daemon é¦–å…ˆä¼—æ‰€å‘¨çŸ¥çš„Docker Daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰æ°¸è¿œæ˜¯rootè¿è¡Œã€‚ é»˜è®¤è¿›ç¨‹å’ŒUID Docker é»˜è®¤çš„è¿›ç¨‹æˆ–è€…åœ¨å®¹å™¨å†…çš„èƒ½è·å¾—åˆ°çš„rootæƒé™å°±æ˜¯å®¿ä¸»çš„root ï¼Œå› ä¸ºé»˜è®¤æ²¡æœ‰å¯ç”¨ user namespace remappingï¼Œæ‰€ä»¥å¦‚æœå®¹å™¨é€ƒé€¸äº†ã€æˆ–è€…è¢«èµ‹äºˆäº†è®¿é—®å®¿ä¸»èµ„æºçš„èƒ½åŠ›ï¼Œå®ƒå°±èƒ½åƒå®¿ä¸»æœº root ä¸€æ ·è¡ŒåŠ¨ã€‚ Dockerå‡ºçš„è§£å†³æ–¹æ³• USER é€‰é¡¹ï¼šè®©å®¹å™¨å†…çš„è¿›ç¨‹ç›´æ¥éƒ½ä»¥æŒ‡å®šUIDè¿è¡Œï¼Œä½†æ˜¯å¸¦æ¥å¾ˆå¤§é—®é¢˜é—®é¢˜æ˜¯ï¼Œå¾ˆå¤šé•œåƒä¼šæ“ä½œéæŒ‚è½½çš„ç³»ç»Ÿç›®å½•ï¼Œæœ€ç®€å•çš„æ¯”å¦‚è¯´/var/log/ ä¸‹åˆ›å»ºlogæ–‡ä»¶ï¼Œéƒ½ä¼šå› ä¸ºérootæ— æ³•åˆ›å»ºï¼Œç›´æ¥æ— æ³•è¿è¡Œã€‚ Envå˜é‡æŒ‡å®šUIDï¼šè¿™ä¸ªå°±æ˜¯æ›´æ˜¯é˜´é—´ä¸­çš„é˜´é—´ã€‚å› ä¸ºè¿™ä¸ªä¸æ˜¯ä¸€ä¸ªæ ‡å‡†æ“ä½œï¼Œæ¯ä¸ªé•œåƒä½œè€…éƒ½æœ‰è‡ªå·±æƒ³æ³•ã€‚ ä¾‹å­1 æ¯”å¦‚è‘—åçš„linuxserver/çš„é•œåƒï¼Œä»–ç‰¹åˆ«è´´å¿ƒçš„è®©ä»–ä»¬å‘å¸ƒçš„æ¯ä¸€ä¸ªé•œåƒéƒ½æ”¯æŒæŒ‡å®šPUIDå’ŒPGIDï¼Œä¼¼ä¹è¿™æ˜¯ä¸€ä¸ªèƒ½è§£å†³ï¼Œä½†æ˜¯ä½ å¯ä»¥çœ‹åˆ°ä»–ä»¬å…·ä½“çš„å®ç°æ–¹å¼ã€‚ åœ¨å®¹å™¨å¯åŠ¨çš„æ˜¯è¯»å–PUID envï¼Œéé»˜è®¤çš„æƒ…å†µä¸‹åˆ›å»ºå¯¹åº”ç”¨æˆ·ï¼Œç„¶åå¯¹æŒ‚è½½ç›®å½•æ‰§è¡Œlsiown https://github.com/linuxserver/docker-baseimage-ubuntu/blob/212ab2133eb21e4e4b536039c790201baf81fd4f/root/etc/s6-overlay/s6-rc.d/init-adduser/run#L53 123456789101112131415161718192021#... #... PUID=${PUID:-911} PGID=${PGID:-911} if [[ -z ${LSIO_READ_ONLY_FS} ]] &amp;&amp; [[ -z ${LSIO_NON_ROOT_USER} ]]; then USERHOME=$(grep abc /etc/passwd | cut -d &quot;:&quot; -f6) usermod -d &quot;/root&quot; abc groupmod -o -g &quot;${PGID}&quot; abc usermod -o -u &quot;${PUID}&quot; abc usermod -d &quot;${USERHOME}&quot; abc fi #... #... if [[ -z ${LSIO_READ_ONLY_FS} ]] &amp;&amp; [[ -z ${LSIO_NON_ROOT_USER} ]]; then lsiown abc:abc /app lsiown abc:abc /config lsiown abc:abc /defaults fi lsiownå¥½åƒä¹Ÿæ˜¯ä»–ä»¬è‡ªå·±åˆ¶ä½œçš„è„šæœ¬æœ¬è´¨å°±æ˜¯chownä¸€ä¸‹ã€‚ https://github.com/linuxserver/docker-mods/blob/cac9e7450a0698f19d750b67db61c4aa214d5290/lsiown.v1#L30 1/usr/bin/find &quot;${PATH[@]}&quot; &quot;${MAXDEPTH[@]}&quot; ! -xtype l \\( ! -group &quot;${GROUP}&quot; -o ! -user &quot;${USER}&quot; \\) -exec chown &quot;${OPTIONS[@]}&quot; &quot;${USER}&quot;:&quot;${GROUP}&quot; {} + || printf &quot;${ERROR}&quot; åªå¯¹Dockerfileé‡Œé¢å®šä¹‰çš„è·¯å¾„chownï¼Œå¯¹äºåª’ä½“åº“è¿™æ ·æŒ‚è½½è·¯å¾„å¤šæ ·çš„æƒ…å†µï¼Œæ ¹æœ¬ç…§é¡¾ä¸åˆ° ç”¨rootå¯¹æŒ‚è½½è¿›æ¥çš„â€œæŒ‡å®šé…ç½®è·¯å¾„â€è¿›è¡Œäº†chownï¼Œæ›´æ”¹äº†æ‰€æœ‰è€…ç›´æ¥ç ´ååŸæ¥çš„æƒé™ã€‚ åªæœ‰åº”ç”¨è¿›ç¨‹æœ¬èº«æ˜¯UIDæ˜¯æŒ‡å®šçš„UIDï¼Œå®¹å™¨å†…æœ¬èº«è¿˜ä¿ç•™rootæƒé™ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨æœ¬èº«è¿˜æ˜¯å­˜åœ¨rootç”¨æˆ·å¹¶ä¸”å¯ä»¥è°ƒç”¨ï¼Œåªè§£å†³æ–‡ä»¶æƒé™é—®é¢˜ï¼Œè€Œä¸”æ˜¯ç ´åæ€§è§£å†³ ä¸æ˜¯å•Šï¼Œè¯´åˆ°åº•ä½ è¿˜æ˜¯èƒ½æ‹¿rootå•Šï¼ˆ ä¾‹å­2 æœ€è¿‘ç¢°åˆ°ä¸€ä¸ªæ›´åŠ å¥‡æ€ªï¼ˆé˜´é—´ï¼‰çš„é•œåƒ â€”&gt; Gitea ï¼Œä»–å®˜æ–¹æä¾›äº†2ä¸ªé•œåƒï¼Œä¸€ä¸ªæ˜¯basicçš„ä¸€ä¸ªæ˜¯rootless å…ˆæ¥çœ‹ä¸‹é¢çš„basicï¼Œæ”¯æŒUSER_UIDæŒ‡å®šï¼Œé‚£ä¹ˆåŸºæœ¬æ¥è¯´åº”è¯¥æ˜¯linuxserverçš„é•œåƒå·®ä¸å¤šçš„æ–¹å¼ã€‚ 12345678910111213services: server: image: docker.gitea.com/gitea:1.23.8 restart: always environment: - USER_UID=1000 - USER_GID=1000 volumes: - ./data:/var/lib/gitea - ./config:/etc/gitea ports: - &quot;3000:3000&quot; - &quot;2222:2222&quot; å®¹å™¨å†…æœ¬èº«è¿˜æœ‰rootæƒé™ï¼Œé€šè¿‡entrypointè¿è¡Œè„šæœ¬ï¼Œæ›¿æ¢passwdæ–‡ä»¶é‡Œé¢gitç”¨æˆ·çš„uidï¼Œå…¶å®ä¹Ÿéƒ½å±äºå¸¸è§„æ“ä½œã€‚ https://github.com/go-gitea/gitea/blob/688da55f543f82265cc7df2bd1cf2bce53188b7a/docker/root/usr/bin/entrypoint#L22 123456789if [ -n &quot;${USER_GID}&quot; ] &amp;&amp; [ &quot;${USER_GID}&quot; != &quot;`id -g ${USER}`&quot; ]; then sed -i -e &quot;s/^${USER}:\\([^:]*\\):[0-9]*/${USER}:\\1:${USER_GID}/&quot; /etc/group sed -i -e &quot;s/^${USER}:\\([^:]*\\):\\([0-9]*\\):[0-9]*/${USER}:\\1:\\2:${USER_GID}/&quot; /etc/passwd fi # Change UID for USER? if [ -n &quot;${USER_UID}&quot; ] &amp;&amp; [ &quot;${USER_UID}&quot; != &quot;`id -u ${USER}`&quot; ]; then sed -i -e &quot;s/^${USER}:\\([^:]*\\):[0-9]*:\\([0-9]*\\)/${USER}:\\1:${USER_UID}:\\2/&quot; /etc/passwd fi é‚£ä¹ˆrootlessé•œåƒå‘¢ï¼Œæˆ‘çœ‹äº†å¾ˆå…´å¥‹ï¼Œç»ˆäºæœ‰äººåšçº¯æ­£çš„rootlessé•œåƒäº†ï¼Œå®˜ç½‘çš„composeäº‹ä¾‹å¦‚ä¸‹ï¼Œå½“æ—¶è§‰å¾—å¥‡æ€ªï¼Œéƒ½rootlessæ€ä¹ˆæ²¡æŒ‡å®šUIDï¼Œæ‰‹åŠ¨åŠ ä¸Šäº†basicé•œåƒé‡Œé¢çš„USER_UIDç¯å¢ƒå˜é‡ï¼Œå‘ç°æ ¹æœ¬è·‘ä¸èµ·æ¥ï¼Œå½“æ—¶åœ¨è¯•podmanï¼Œä»¥ä¸ºæ˜¯podmanå“ªé‡Œæ²¡é…å¯¹ã€‚ 1234567891011121314version: &quot;2&quot; services: server: image: docker.gitea.com/gitea:1.23.8-rootless restart: always volumes: - ./data:/var/lib/gitea - ./config:/etc/gitea - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro ports: - &quot;3000:3000&quot; - &quot;2222:2222&quot; ç„¶åå¥½å¥‡çœ‹äº†çœ¼å®˜æ–¹æ‰“åŒ…çš„Dockerfileã€‚ https://github.com/go-gitea/gitea/blob/688da55f543f82265cc7df2bd1cf2bce53188b7a/Dockerfile.rootless#L77 123456# git:git USER 1000:1000 ENV GITEA_WORK_DIR=/var/lib/gitea ENV GITEA_CUSTOM=/var/lib/gitea/custom ENV GITEA_TEMP=/tmp/gitea ENV TMPDIR=/tmp/gitea è°TMDçš„rootlessé•œåƒæŒ‡å®š1000 uidä¸èƒ½æ›´æ”¹ç”¨çš„ï¼Ÿæœ€åè‡ªå·±æ‹‰è¿‡æ¥æ”¹äº†dockerfileç„¶åç¼–è¯‘ ä¾‹å­3 é™¤äº†ä¸Šé¢é‚£äº›å¥½æ­¹ä½ èƒ½æŒ‡å®šä¸€ä¸‹ï¼Œæœ‰äº›é•œåƒï¼Œä½ çœŸçš„ä¸çŸ¥é“ä»–ä»¬æ˜¯ä»€ä¹ˆUIDé•œåƒã€‚ postgresè¿™ä¹ˆä¸€ä¸ªå¸¸ç”¨é•œåƒï¼Œé»˜è®¤uidæ˜¯999ï¼ŒæŒ‚è½½ç›®å½•è¿›å»å› ä¸ºæƒé™é™åˆ¶çš„æ¯”è¾ƒæ­»ï¼Œç›´æ¥æç¤ºæƒé™ä¸å¤Ÿã€‚ è™½ç„¶postgresåº“ä¸‹é¢æç¤ºï¼Œå¯ä»¥ç›´æ¥ç”¨userå»æŒ‡å®šuidè¿è¡Œï¼Œä½†æ˜¯ä½ éœ€è¦å»å¤„ç†passwdæ–‡ä»¶ã€‚ [!NOTE] As of docker-library/postgres#253â , this image supports running as a (mostly) arbitrary user via --user on docker run. As of docker-library/postgres#1018â , this is also the case for the Alpine variants. The main caveat to note is that postgres doesnâ€™t care what UID it runs as (as long as the owner of /var/lib/postgresql/data matches), but initdbdoes care (and needs the user to exist in /etc/passwd): æŒ‚è½½ç›®å½•æ²¡æ³•å¤„ç†æƒé™è¿™ä¸ªé—®é¢˜ï¼Œåœ¨k8sæˆ–è€…å¤§å‹é¡¹ç›®ä¸­éƒ½ä¼šä½¿ç”¨å·æŒ‚è½½æˆ–è€…pvcä¹‹ç±»çš„å—å­˜æ¥é¿å…æƒé™é—®é¢˜ï¼Œä½†æ˜¯åœ¨å®¶é‡ŒæŒ‚è½½ç›®å½•è¿˜æ˜¯æ›´å¥½ç»´æŠ¤æ“ä½œæ–‡ä»¶ï¼Œå¹¶ä¸”å¥½åšå¿«ç…§æ¢å¤ã€‚ æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼Œæ¯ä¸ªå®¹å™¨é•œåƒçš„å®ç°æ–¹å¼æ ¹æ®å¼€å‘è€…çš„å–œå¥½äº”èŠ±å…«é—¨ï¼Œå±‚æ¬¡ä¸é½ã€‚ä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯å› ä¸ºdockeræœ¬èº«æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½ä¸”è§„èŒƒçš„è§£å†³æ–¹æ³•ã€‚ æœ€ä½³å®è·µ åŸç† ç®€å•æ¥è¯´ï¼ŒæŠŠDockerå¡è¿›å¦å¤–çš„éç‰¹æƒçš„ç³»ç»Ÿçº§å®¹å™¨ï¼ˆincusæˆ–è€…lxcï¼‰ä¸­ï¼Œé€šè¿‡idmaps æ˜ å°„hostæœºå™¨çš„ä¸€ä¸ªç»„ï¼Œè®©å®¹å™¨å†…è¦ä½¿ç”¨çš„æ‰€æœ‰ç”¨æˆ·åŠ å…¥è¿™ä¸ªå®¹å™¨å†…çš„è¿™ä¸ªç»„ï¼Œä¹Ÿå°±ä¼šè¢«è‡ªåŠ¨æ˜ å°„åˆ°hostçš„ç»„ã€‚å¦å¤–incuså’Œlxcè¿™ç±»å®¹å™¨é»˜è®¤çš„rootç”¨æˆ·ä¹Ÿä¼šè¢«æ˜ å°„åˆ°ä¸»æœºéå¸¸å¤§uidï¼ˆ65534+ï¼‰çš„érootç”¨æˆ·æ¥ç¡®ä¿å®‰å…¨æ€§ã€‚ https://linuxcontainers.org/incus/docs/main/userns-idmap/ é‚£ä¹ˆï¼Œåœ¨incuså®¹å™¨ä¸­çš„debianï¼Œæˆ‘ä»¬å°±å¯ä»¥éšæ„è¿è¡Œdockerå®¹å™¨å³ä½¿è¿™ä¸ªåº”ç”¨æ˜¯root ä»–è·å¾—æŒ‚è½½æ–‡ä»¶æƒé™çš„æ˜ å°„è·¯å¾„æ˜¯ UID:0(Docker) -&gt; UID:0 (IncusDebian) -&gt; GID:3004(IncusDebian) -&gt; GID:3004(TrueNAS Host) é‚£ä¹ˆå³ä½¿Dockerå®¹å™¨è¢«çªç ´ï¼Œä»–èƒ½è·å–åˆ°çš„æœ€å¤§æƒé™æ˜¯TrueNAS UID:65534+ | GUID:65534+çš„è¿›ç¨‹æƒé™å’ŒGID:3004çš„æ–‡ä»¶æƒé™ å…·ä½“æ“ä½œ IDMaps å…ˆæ·»åŠ ä¸€ä¸ªidmapsï¼Œåœ¨TrueNAS GUIé‡Œé¢ Instance -&gt; Configuration -&gt; Map User/Group IDs, è½¬åˆ°Groupsé€‰é¡¹ï¼Œæ·»åŠ ä½ æƒ³è¦æ˜ å°„çš„ç»„ï¼Œåœ¨å›¾é‡Œï¼Œæˆ‘æ˜ å°„äº†åå­—rootless çš„ GID:3004çš„å›¾ï¼Œæ‰€ä»¥æˆ‘æŒ‚è½½çš„æ‰€æœ‰çš„è·¯å¾„éƒ½ä¼šåœ¨æ•°æ®é›†é‡Œé¢æ·»åŠ rootlessçš„æƒé™ã€‚ PSï¼šæ³¨æ„æ·»åŠ æƒé™çš„æ—¶å€™ï¼Œè¯·ç›´æ¥æ·»åŠ ä¸ºOwner Groupï¼ˆæ‰€æœ‰ç»„ï¼‰ï¼Œè€Œä¸æ˜¯ä½¿ç”¨NFS/SMB ACLæƒé™çš„ä¸‹çš„æƒé™ï¼Œå¹¶ä¸”å‹¾é€‰Apply Groupä»¥åŠé€’å½’ï¼Œå¦‚æœä½ è¦ä½¿ç”¨ACLæƒé™ï¼Œè¯·ä½¿ç”¨POSIX ACLæƒé™ Incusè¿è¡ŒDebianä»¥åŠDockerç¯å¢ƒ å®‰è£…Debianæ²¡ä»€ä¹ˆæŠ€å·§ï¼Œç›´æ¥åœ¨GUIé€‰æ‹©debianå®‰è£…ï¼Œç„¶åæŒ‚è½½ä½ éœ€è¦çš„è·¯å¾„å°±è¡Œäº†ã€‚ å®‰è£…å®Œæˆåï¼Œå› ä¸ºGUIè¿˜æœ‰å¾ˆå¤šé€‰é¡¹æ²¡æœ‰å¼€å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦CLIé…ç½®ä¸€ä¸‹ 1sudo incus config edit [debianå®¹å™¨å] ä½ éœ€è¦åœ¨config: çš„é‡Œé¢æ·»åŠ æ·»åŠ è¿™ä¸‰è¡Œä¹‹åï¼Œä¿å­˜é€€å‡ºï¼ˆnanoæ“ä½œï¼‰ 123security.nesting: &quot;true&quot; security.syscalls.intercept.mknod: &quot;true&quot; security.syscalls.intercept.setxattr: &quot;true&quot; é‡å¯å®¹å™¨ 1sudo incus restart [debianå®¹å™¨å] è¿›å…¥å®¹å™¨å®‰è£…Dockerï¼Œæ³¨æ„ä½ çš„ç½‘ç»œç¯å¢ƒ 1234sudo incus shell [debianå®¹å™¨å] apt update &amp;&amp; apt install nano curl -y curl -fsSL https://get.docker.com -o get-docker.sh sh get-docker.sh æ·»åŠ ç»„ï¼Œå°†rootåŠ å…¥ç»„rootless 1234groupadd -g 3004 rootless usermod -aG rootless root #é‡æ–°ç™»é™†ç”Ÿæ•ˆ su - root ç„¶åä½ å†å»æ£€æŸ¥æŒ‚è½½è·¯å¾„ï¼Œä¼šå‘ç°rootå·²ç»èƒ½æ­£å¸¸è®¿é—®ã€‚æ­¤æ—¶ä½ å·²ç»èƒ½è¿è¡Œå¤§éƒ¨åˆ†å®¹å™¨äº† å„ç§å®¹å™¨çš„åº”å¯¹æ–¹æ³• å¯é…ç½®UID/GIDçš„å®¹å™¨ å¯ä»¥è€ƒè™‘ç›´æ¥é…ç½®ä¸ºUID=0 GID=3004åŸºæœ¬ä¸Šèƒ½è¿è¡Œã€‚ ä¸å¯é…ç½®ï¼Œå›ºå®šUIDçš„å®¹å™¨ æ¯”å¦‚postgresè¿™æ ·ä»¥UID=999è¿è¡Œçš„å®¹å™¨ï¼Œå¯ä»¥æ¨¡ä»¿rootåŠ å…¥ç»„çš„æ–¹å¼ï¼Œå…ˆæ‰¾åˆ°ç³»ç»ŸUID=999çš„åº”ç”¨ï¼Œä¾‹å¦‚ä¸ºè¿™è¾¹æ˜¯netdata 12root@Debian:~# cat /etc/passwd | grep 999 netdata:x:999:997::/var/lib/netdata:/bin/sh ç„¶åè®©netdataåŠ å…¥rootlessç»„ï¼Œpostgreså°±èƒ½æ­£å¸¸è¿è¡Œäº† 1usermod -aG rootless netdata å¤šè¿›ç¨‹ä¸åŒUIDæˆ–è€…å³ä½¿æŒ‡å®šGID è¿˜æ˜¯æ²¡æƒé™ éƒ¨åˆ†å®¹å™¨é•œåƒUIDå¤„ç†æ–¹å¼å¥½åƒä¸æ­£å¸¸ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦è¿›å…¥è¿™ä¸ªdockerå®¹å™¨ï¼ŒæŠŠå®¹å™¨å†…éƒ¨çš„ /etc/group æ–‡ä»¶å¤åˆ¶å‡ºæ¥ï¼Œç„¶å ps auxæŸ¥çœ‹è¿›ç¨‹çš„UID åœ¨æœ€åä¸€è¡ŒåŠ ä¸Šï¼Œå³è®©å®¹å™¨çš„rootä»¥åŠè¿›ç¨‹IDåŠ å…¥rootlessç»„ï¼ˆæ²¡é”™å°±æ˜¯è¿™ä¹ˆé˜´é—´ï¼Œå®¹å™¨å†…çš„rootæœ‰æ—¶å€™ä¼šç»§æ‰¿ä¸åˆ°ç»„æƒé™ï¼‰ 1rootless:x:3004:root,[å„ç§è¿›ç¨‹ID] ç„¶åæ”¹å®Œçš„æ–‡ä»¶å†åœ¨composeé‡Œé¢æŒ‚è½½å› å®¹å™¨å†…çš„ /etc/group 1234567services: server: #..... volumes: - ./fake-group-file:/etc/group #..... #..... æ€»ç»“ æ€»ä½“ä¸‹æ¥ï¼Œä¸ºäº†Dockerå®‰å…¨æ€§å…¶å®ä»˜å‡ºçš„ç»´æŠ¤é‡è¿˜æ˜¯æŒºå¤§çš„ï¼Œå½“ç„¶å¦‚æœä½ ä¸æ˜¯æœ‰éœ€è¦æš´éœ²å…¬ç½‘ï¼Œä¸”ä¸åœ¨ä¹æƒé™ï¼Œä½ å½“ç„¶å¯ä»¥rootä¸€æŠŠå—¦ï¼ŒèŠ‚çº¦è‡ªå·±çš„æ—¶é—´ã€‚ å¦å¤–å¯èƒ½æœ‰äººä¼šæåˆ°Podmanï¼Œåœ¨å®‰å…¨æ€§ä¸Šèƒ½è®©å®¹å™¨é»˜è®¤å°±æ˜ å°„rootç”¨æˆ·ï¼Œ100%é¿å…äº†rootè¿›ç¨‹çš„é—®é¢˜ï¼Œç½‘ç»œæ–¹é¢ä¹Ÿå¹²å¹²å‡€å‡€ï¼Œä½†æ˜¯Podmanä»å†å²æ¥çœ‹å˜åŠ¨å¤ªå¤§äº†ï¼Œä»composeè½¬æ¢çš„æ”¯æŒåˆ°ç°åœ¨çš„quadletçš„å†™æ³•ï¼Œä»¥åŠå¬è¯´è¦æ”¯æŒkube applyçš„yamlå†™æ³•ã€‚è®©æˆ‘åœ¨ä¸»åŠ›æœºå™¨ä¸Šä½¿ç”¨æ²¡æœ‰å¾ˆå¤§åŠ¨åŠ›ã€‚å¦å¤–æ”¯æŒPodmançš„ç®¡ç†å·¥å…·å¤§éƒ¨åˆ†éƒ½è¿˜åœç•™åœ¨composeã€‚å…¼å®¹æ€§å·®çš„è¦å‘½ï¼Œå„ç§optionä¸å…¼å®¹ã€‚","categories":[],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://homelabproject.cc/tags/Docker/"},{"name":"TrueNAS","slug":"TrueNAS","permalink":"https://homelabproject.cc/tags/TrueNAS/"},{"name":"Incus","slug":"Incus","permalink":"https://homelabproject.cc/tags/Incus/"}]},{"title":"Mellanox SN2700 é£æ‰‡ æ”¹é€ ","slug":"Others/Mellanox SN2700 é£æ‰‡ æ”¹é€ ","date":"2025-05-21T15:00:00.000Z","updated":"2025-06-19T04:44:26.917Z","comments":true,"path":"Others/Mellanox SN2700 é£æ‰‡ æ”¹é€ /","permalink":"https://homelabproject.cc/Others/Mellanox%20SN2700%20%E9%A3%8E%E6%89%87%20%E6%94%B9%E9%80%A0/","excerpt":"","text":"å‡ ä¸ªæœˆå‰åœ¨é—²é±¼åˆ·åˆ°ç¾¤é‡Œçš„æµé‡ç‹äº¤æ¢æœºSN2700ï¼Œä½†æ˜¯ç»“å°¾æ˜¯Bï¼Œé—®å–å®¶å’Œçœ‹datasheetåº”è¯¥æ˜¯ä¸ª40Gï¼Œä½†æ˜¯ç½‘ä¸Šæœäº†ä¸€ä¸‹æœ‰äººä¹°è¿‡SN2100å¸¦Bç»“æœå®é™…èƒ½è·‘100Gã€‚å’Œå–å®¶ä¸€é¡¿ç ä»·ï¼Œ5Kå‡ºå¤´ï¼Œè€ƒè™‘åˆ°ä»·æ ¼ï¼Œç¬¦åˆåƒåœ¾ä½¬ä¸ä¸€å®šç”¨å¾—åˆ°ä½†æ˜¯ä¸€å®šè¦æ¡æ¼ã€‚ æ‹¿åˆ°æ‰‹ä¸€çœ‹ï¼Œç¡®å®èƒ½100Gï¼Œå®é™…æµ‹é€Ÿä¹Ÿæ²¡é—®é¢˜ã€‚ å‰©ä¸‹é‡åˆ°çš„é—®é¢˜å°±æ˜¯å™ªéŸ³ï¼Œè™½ç„¶SN2700ä¹Ÿèƒ½æƒ³SX60xxç³»åˆ—ç”¨å‘½ä»¤æ§åˆ¶ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæ¥å›æ‹‰å‡ï¼Œæ™®éåœ¨1wè½¬ï¼Œæ»¡è½½2wï¼Œæ”¾åœ¨ä¸€ä¸ªå°æˆ¿é—´åœ¨å¤–é¢ä¹Ÿå¬å¾—åˆ°ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—æ”¹ä¸€ä¸‹ã€‚ SN2700çš„é£æ‰‡æ˜¯æ¨¡ç»„åŒ–çš„ï¼Œæ¨¡ç»„ä¸Šæœ‰ä¸ª8pinçš„æ¯åº§ï¼Œæ˜¯sh1.0ï¼Œå»ºè®®æ·˜å®ä¹°å¸¦çº¿åšå¥½çš„ï¼Œå› ä¸ºsh1.0çš„ç«¯å­æ˜¯çœŸçš„å‹ä¸å‡ºæ¥ã€‚ï¼ˆå¦å¤–æ·˜å®sh1.0çš„èƒ¶å£³æ™®éè´¨é‡å·®ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´è„šè¢«å‹æ­ªï¼Œä¸€å®šè¦ç›´ä¸Šç›´ä¸‹ä½¿ç”¨ï¼‰ çº¿åºå¦‚ä¸‹å›¾å·¦åˆ°å³ï¼š [!çº¿åº] 12V ï½œ æµ‹é€Ÿ ï½œ PWMè°ƒé€Ÿ ï½œ GND ï½œ 12V ï½œ æµ‹é€Ÿ ï½œ PWMè°ƒé€Ÿ ï½œ GND æ”¹é£æ‰‡çš„å…³é”®ç‚¹ï¼š PWMè°ƒé€Ÿ ä¸èƒ½æ¥ï¼Œè®©é£æ‰‡ç›´æ¥æ»¡é€Ÿè¿è¡Œ 2ä¸ªæµ‹é€Ÿè„šä¸€å®šè¦æ¥ é£æ‰‡è½¬é€Ÿå¤§äº ä¸ç­‰äº5Kè½¬ï¼ˆä½äºç³»ç»Ÿæœ€ä½é˜ˆå€¼ï¼Œä½†æ˜¯ä¸åœ¨ä¹æŠ¥é”™æ˜¯èƒ½ç”¨çš„ï¼‰ é£æ‰‡åªèƒ½æ»¡é€Ÿçš„è¯ï¼Œå¯¼è‡´4056é£æ‰‡æ²¡å¾—é€‰ï¼Œå› ä¸ºæ‰€æœ‰4056éƒ½æ˜¯1-2wè½¬æ»¡é€Ÿï¼Œæˆ‘è¿™é‡Œçš„åŠæ³•æ˜¯é€‰æ‹©å•ä¸ª4028æˆ–è€…2ä¸ª4020é£æ‰‡ å•ä¸ªé£æ‰‡çš„è¯ï¼Œæ¨èarctic 4028 6Kï¼Œè½¬é€Ÿè¾¾æ ‡ï¼Œæ€§èƒ½å¯ä»¥ã€‚ï¼ˆä¸è¦ä¹°æ±•å¤´æ‰‡å­ï¼æ°¸è¿œä¸æ˜¯è´´æ ‡ä¸Šçš„å‹å·çš„ç¿»æ–°ï¼‰ï¼Œåšçº¿çš„è¯ï¼ŒæŠŠ2ä¸ªæµ‹é€Ÿè„šéƒ½è¿é£æ‰‡çš„ä¸€ä¸ªè„šä¸Šå³å¯ï¼Œå…¶ä»–è„šæ­£å¸¸é“¾æ¥ã€‚ 2ä¸ª4020çš„è¯ï¼Œéšä¾¿ä¹°å§ï¼Œæ‰¾ä¸ªæ­£å“çš„6Kå·¦å³çš„3çº¿æˆ–è€…4çº¿é£æ‰‡ï¼Œä¸€å®šå¸¦æµ‹é€Ÿï¼Œé™¤äº†pwmè°ƒé€Ÿä¸æ¥å…¶ä»–ç»ƒåˆ°å¯¹åº”è„šå°±è¡Œã€‚ç„¶åéœ€è¦2ä¸ªéš”ç¦»æŸ±ï¼Œå¤ªè¿‘äº†å› ä¸ºä¸æ˜¯åæ¡¨åè€Œæ•ˆæœå·®ï¼Œéœ€è¦éš”å¼€ç‚¹ï¼Œæˆ‘è¿™é‡Œæ˜¯3Dæ‰“å°çš„ã€‚ï¼ˆ6-2.8-5.8/6-2.8-9.5/å¤–ç»-å†…å¾„-é•¿åº¦ï¼‰æ¯ä¸ªæ¨¡å—æ¯æ ·2ä¸ªã€‚æœ€åæ•ˆæœæ˜¯è¿™æ · å›¾ä¸€ä¹çš„æ˜¯ï¼Œæˆ‘æ¯æ ·åšäº†2ä¸ªï¼ˆ æ“¦ç”µä¸Šæœºï¼Œè½¬é€Ÿéƒ½èƒ½è¯†åˆ«åˆ°ï¼Œä½†æ˜¯ä½äº5Kçš„å‡ æŠŠé£æ‰‡è¿‡ä¸€ä¼šå°±ä¼šæŠ¥è½¬é€Ÿè¿‡ä½ï¼Œæœ‰ç©ºå†æ¢æ‰ã€‚ å†¬å¤©å®¤æ¸©å¾ˆä½ï¼Œæ¸©åº¦ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¤å¤©å¯èƒ½ä¼šé«˜ç‚¹ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æˆ‘ä¼°è®¡è¿ä¸€åŠç«¯å£éƒ½ç”¨ä¸äº†ï¼Œå‹åŠ›ä¹Ÿä¸å¤§ã€‚","categories":[],"tags":[{"name":"Hardware","slug":"Hardware","permalink":"https://homelabproject.cc/tags/Hardware/"}]},{"title":"TrueNAS æ—¥å¿—è¿‡å¤š","slug":"TrueNAS/TrueNAS æ—¥å¿—è¿‡å¤š debug","date":"2025-04-19T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"TrueNAS/TrueNAS æ—¥å¿—è¿‡å¤š debug/","permalink":"https://homelabproject.cc/TrueNAS/TrueNAS%20%E6%97%A5%E5%BF%97%E8%BF%87%E5%A4%9A%20debug/","excerpt":"","text":"1journalctl -q --no-pager --output=json | jq -r &#39;._SYSTEMD_UNIT&#39; | sort | uniq -c | sort -nr 1cat /var/log/middlewared.log","categories":[],"tags":[{"name":"TrueNAS","slug":"TrueNAS","permalink":"https://homelabproject.cc/tags/TrueNAS/"}]},{"title":"TrueNAS  APPï¼ˆdockerï¼‰æ›¿æ¢å®˜æ–¹å­˜å‚¨åº“ï¼ˆrepo","slug":"TrueNAS/TrueNAS  APPï¼ˆdockerï¼‰æ›¿æ¢å®˜æ–¹å­˜å‚¨åº“ï¼ˆrepoï¼‰","date":"2025-02-16T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"TrueNAS/TrueNAS  APPï¼ˆdockerï¼‰æ›¿æ¢å®˜æ–¹å­˜å‚¨åº“ï¼ˆrepoï¼‰/","permalink":"https://homelabproject.cc/TrueNAS/TrueNAS%20%20APP%EF%BC%88docker%EF%BC%89%E6%9B%BF%E6%8D%A2%E5%AE%98%E6%96%B9%E5%AD%98%E5%82%A8%E5%BA%93%EF%BC%88repo%EF%BC%89/","excerpt":"","text":"ä¸æƒ³å­¦ æˆ‘å·²ç»é•œåƒåˆ°Giteeäº†ï¼Œæ¯æ—¥å®šæ—¶æ›´æ–°ï¼Œä¸‹é¢è„šæœ¬ç›´æ¥æ‰§è¡Œå°±èƒ½æ›¿æ¢ï¼Œå¯ä»¥æ”¾åˆ°å¼€æœºå¯åŠ¨ï¼Œé‡å¯æˆ–è€…æ›´æ–°ä¹Ÿæœ‰æ•ˆ https://gitee.com/channinghe/truenas-apps 1234567cd /mnt/ä½ æ”¾è„šæœ¬çš„åœ°æ–¹ wget https://file.homelabproject.cc/d/local/Server/Src/truenas/tn-apps-repo-rp.sh chmod +x ./tn-apps-repo-rp.sh bash ./tn-apps-repo-rp.sh --mirrors-url https://gitee.com/channinghe/truenas- åŸç† é¦–å…ˆå®˜æ–¹å­˜å‚¨åº“å®šä¹‰æ–‡ä»¶åœ¨ /usr/lib/python3/dist-packages/middlewared/plugins/catalog/utils.py è¿™æ˜¯ä¸ªä¸å¯è¯»æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨mountçš„æ–¹å¼ ä¸‹é¢æ“ä½œä¸€å¾‹rootæ“ä½œ æ³¨æ„è‡ªå·±å¤‡ä»½æ–‡ä»¶ å…ˆåˆ°ä¸€ä¸ªæ”¾utils.py æ›¿æ¢æ–‡ä»¶çš„è·¯å¾„ï¼Œå¤åˆ¶æºæ–‡ä»¶ 1cd /mnt/xxx/xxx 1cp /usr/lib/python3/dist-packages/middlewared/plugins/catalog/utils.py ./utils.py ä¿®æ”¹URLï¼Œä½ å¯ä»¥nanoè‡ªå·±æ”¹OFFICIAL_CATALOG_REPO = 'https://github.com/truenas/apps' å†…ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„sedç›´æ¥æ›¿æ¢ 1sed -i &#39;s|https://github.com/truenas/apps|https://[github åŠ é€Ÿé•œåƒ]/truenas/apps|g&#39; ./utils.py ç”¨mount â€”bindå¼ºåˆ¶è¦†ç›– 1mount --bind ./utils.py /usr/lib/python3/dist-packages/middlewared/plugins/catalog/utils.py æœ€åé‡å¯ä¸­é—´ä»·å³å¯ 1systemctl restart middlewared","categories":[],"tags":[{"name":"TrueNAS","slug":"TrueNAS","permalink":"https://homelabproject.cc/tags/TrueNAS/"}]},{"title":"Ros é™æ€è·¯ç”± åˆ° å†…ç½‘VPNç½‘å…³æ…¢","slug":"Others/RouterOS é™æ€è·¯ç”± åˆ° å†…ç½‘VPNç½‘å…³æ…¢","date":"2025-02-09T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"Others/RouterOS é™æ€è·¯ç”± åˆ° å†…ç½‘VPNç½‘å…³æ…¢/","permalink":"https://homelabproject.cc/Others/RouterOS%20%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%20%E5%88%B0%20%E5%86%85%E7%BD%91VPN%E7%BD%91%E5%85%B3%E6%85%A2/","excerpt":"","text":"é—®é¢˜ RouterOSåœ¨é™æ€è·¯ç”± ï¼ˆVPNç½‘æ®µæˆ–è€… å¼‚åœ°ç½‘æ®µï¼‰ åˆ°å†…ç½‘VPNç½‘å…³æ—¶ï¼Œä¼šé‡åˆ°ä½“ç°æ˜¯ç¬¬ä¸€ä¸ªå“åº”å¾ˆæ…¢ï¼Œä½†æ˜¯åŠ è½½åæ­£å¸¸ã€‚ æ’éš¾ï¼Œiperf3æµ‹è¯•å¸¦å®½æ²¡é—®é¢˜ï¼Œpingå»¶è¿Ÿä¹Ÿæ­£å¸¸çš„æƒ…å†µã€‚ åŸå›  ï¼ˆæ‡’å¾—å†™å¤ªé•¿ï¼Œå»ºè®®çœ‹ä¸‹æ–¹é“¾æ¥ï¼‰ å¤§æ¦‚å°±æ˜¯æœ¬åœ°å‘åŒ…è½¬å‘ç»™å†…ç½‘VPNç½‘å…³å‡ºå£åè¿æ¥æ— æ³•è¿½è¸ªååˆ¤å®šä¸ºâ€invalidâ€ï¼Œé€šå¸¸åœ¨é˜²ç«å¢™è§„åˆ™æœ€åä¼šæœ‰ 1chain=forward action=drop connection-state=invalid å¯¼è‡´è¿æ¥å‡ºç°â€invalidâ€åç›´æ¥è¢«dropæ‰äº† è§£å†³ åœ¨chain=forward action=drop connection-state=invalid å‰æ·»åŠ  1chain=forward action=accept connection-state=invalid,new src-address=192.168.2.0/24 dst-address=10.1.1.0/24 in-interface=lan-bridge å³å¯ã€‚ scr-addressæ˜¯ä½ çš„lanåœ°å€ï¼Œdst-addressæ˜¯ä½ çš„æƒ³è¦çš„é™æ€è·¯ç”±çš„ç½‘æ®µï¼ˆVPNç½‘æ®µæˆ–è€… å¼‚åœ°ç½‘æ®µï¼‰ å°±æ˜¯æ¥å—è½¬å‘åˆ°é™æ€è·¯ç”±çš„ç½‘æ®µçš„â€invalidâ€åŒ… å‚è€ƒ https://forum.mikrotik.com/viewtopic.php?t=171177","categories":[],"tags":[{"name":"RouterOS","slug":"RouterOS","permalink":"https://homelabproject.cc/tags/RouterOS/"}]},{"title":"TrueNAS SCALE NVMe of (nvmetcli)æ•™ç¨‹","slug":"TrueNAS/TrueNAS SCALE NVMe of (nvmetcli)æ•™ç¨‹","date":"2025-01-18T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"TrueNAS/TrueNAS SCALE NVMe of (nvmetcli)æ•™ç¨‹/","permalink":"https://homelabproject.cc/TrueNAS/TrueNAS%20SCALE%20NVMe%20of%20(nvmetcli)%E6%95%99%E7%A8%8B/","excerpt":"","text":"æ›´æ–° 2025.05.29 NVME-OFå°†åœ¨25.10 å®˜æ–¹æ”¯æŒ è§†é¢‘æ•™ç¨‹ https://www.bilibili.com/video/BV1AgrYY6EYn å‰è¨€ TrueNAS SCALEä½œä¸ºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿï¼Œåœ¨NVMe SSDä»·æ ¼è¶Šæ¥è¶Šé¦™ï¼Œå…¶å®ä¸€ç›´ç¼ºå°‘é«˜æ€§èƒ½çš„å…±äº«å­˜å‚¨æ–¹å¼ã€‚ å¯¹äºè‡ªå¸¦çš„NFSæ¥è¯´ï¼Œå¼€å¯RDMAéå¸¸ç®€å•åªéœ€è¦ç»™å‡ºrdmaç«¯å£ä»¥åŠåŠ è½½æ¨¡å—ï¼Œé…ç½®ååˆ†ç®€å•ã€‚SMB directçš„è¯SCALEçš„å†…æ ¸ä¸æ”¯æŒï¼Œæ‰€ä»¥æƒ³è¦æ”¹èµ·æ¥å°±éå¸¸éº»çƒ¦ã€‚ å—å­˜å‚¨åœ¨2025å¹´åªæœ‰ISCSIå¯¹äºé«˜è´Ÿè½½çš„åº”ç”¨æ¥è¯´ï¼Œæ˜¾å¾—å°±ä¸å¤Ÿäº†ï¼Œæ— è®ºæ˜¯tcpè¿˜æ˜¯rdmaçš„NVMeOFåœ¨å„ç§æ–¹é¢éƒ½ä¼˜äºISCSIï¼Œè€Œä¸”èƒ½æ˜¾è‘—é™ä½CPUçš„åˆ©ç”¨ç‡ã€‚ å…¶å®SCALEçš„ä¼ä¸šç‰ˆå·²ç»æ”¯æŒäº†NVMeOF æ¥æºï¼šhttps://www.starwindsoftware.com/blog/iscsi-vs-nvme-of-performance-comparison/ ä»¥åŠå…¶ä»–çš„ä¸€äº›å¯¹æ¯”ï¼šhttps://kb.blockbridge.com/technote/proxmox-iscsi-vs-nvmetcp/# æ‰€ä»¥é…ç½®NVMeOfè¿«åœ¨çœ‰ç«ï¼ˆä¸æ˜¯ã€‚ å…¥é—¨ï¼ˆ å¯¹äºTrueNAS SCALEï¼Œå› ä¸ºæ›´æ–°ä¼šä¸¢å¤±å‘½ä»¤è¡Œæ‰€æœ‰çš„å†…å®¹ï¼Œæ‰€ä»¥ä½¿ç”¨nvmetcli ä¿å­˜é…ç½®æ–‡ä»¶ï¼Œåœ¨æ›´æ–°ååªéœ€è¦åŠ è½½pythonç¯å¢ƒï¼Œpipå®‰è£…ä¾èµ–ï¼Œæ‰§è¡Œnvmetcli restore config.json å³å¯æ¢å¤nvmeofã€‚ å…·ä½“æ“ä½œ é…ç½®ç¯å¢ƒ å…¶å®å·²ç»æœ‰é¡¹ç›®å†™å¥½äº†è„šæœ¬ï¼Œæˆ‘ä»¬å°±ä¸é‡å¤é€ è½®å­ï¼Œç®€å•è®ºè¿°ä½¿ç”¨æ–¹æ³• https://github.com/democratic-csi/democratic-csi/blob/master/contrib/scale-nvmet-start.sh 1234#åˆ‡æ¢root su - root #è¾“å…¥å¯†ç  curl -o /mnt/æ± åå­—/ä½ æ”¾è„šæœ¬/æ•°æ®é›†çš„åå­—/scale-nvmet-start.sh https://raw.githubusercontent.com/democratic-csi/democratic-csi/refs/heads/master/contrib/scale-nvmet-start.sh ä½œä¸ºä¾‹å­æˆ‘è¿™é‡Œçš„è„šæœ¬æ”¾åœ¨CPool/myscripts ,åé¢éƒ½è¦æ›¿æ¢æˆ‘è¿™é‡Œçš„è·¯å¾„ 1234#åˆ‡æ¢root su - root #è¾“å…¥å¯†ç  curl -o /mnt/CPool/myscripts/scale-nvmet-start.sh https://raw.githubusercontent.com/democratic-csi/democratic-csi/refs/heads/master/contrib/scale-nvmet-start.sh ç„¶åç»™äºˆæ‰§è¡Œæƒé™ 1chmod +x /mnt/CPool/myscripts/scale-nvmet-start.sh éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªè„šæœ¬é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–~~configshell_fb~~ ï¼Œè¿™ä¼šå¯¼è‡´æŠ¥é”™ï¼Œéœ€è¦æŒ‡å®šç‰ˆæœ¬1.1.30 ä¹Ÿå°±æ˜¯ä¿®æ”¹è¿™ä¸ªè„šæœ¬~~pip install configshell_fb~~ åˆ°~~pip install configshell_fb==1.1.30~~ ç„¶åæ‰§è¡Œè„šæœ¬ å¿½ç•¥ä¸Šé¢çš„è¯ï¼Œæäº¤ä¿®å¤çš„PRä»¥åŠåˆå¹¶ï¼Œé»˜è®¤å°±æ˜¯å®‰è£…è¿™ä¸ªç‰ˆæœ¬çš„äº†ã€‚ 1bash /mnt/CPool/myscripts/scale-nvmet-start.sh å¦‚æœä½ ç½‘ç»œæ²¡é—®é¢˜ï¼Œé‚£ä¹ˆè¿™ä¸ªè„šæœ¬ä¼šå¸®ä½ å®Œæˆä¸€åˆ‡çš„é…ç½® nvmetctlé…ç½®NVMeOF æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›å…¥nvmetcliå‘½ä»¤è¡Œï¼Œæ³¨æ„æ›¿æ¢CPool/myscripts 1/mnt/CPool/myscripts/nvmet-venv/bin/python /root/.local/bin/nvmetcli é¦–å…ˆè¦é…ç½®ä¸€ä¸ª**subsystems å’Œ** namespaces 1234subsystems/ create nqn=ä½ çˆ±å«ä»€ä¹ˆå«ä»€ä¹ˆ #ç„¶åçˆ±å«ï¼Œæˆ‘è¿™é‡Œå«testof #åˆ›å»ºnamespaces subsystems/testof/namespaces create nsid=1 ç„¶åä½ å¯ä»¥è¾“å…¥lsæŸ¥çœ‹ç°åœ¨çš„é…ç½® 123456789/&gt; ls o- / ......................................................................................................................... [...] o- hosts ................................................................................................................... [...] o- ports ................................................................................................................... [...] o- subsystems .............................................................................................................. [...] o- testof .............................................................. [version=1.3, allow_any=0, serial=2cb2b6bc4b46653b7680] o- allowed_hosts ....................................................................................................... [...] o- namespaces .......................................................................................................... [...] o- 1 ........................................... [path=(null), uuid=d88dc614-c22d-4942-8a97-5108f210aa1f, grpid=1, disabled] è¿™é‡Œå°±è¦ä¿®æ”¹è¿™ä¸ªnamespacesçš„pathåˆ°ä½ çš„zvolè·¯å¾„,æˆ‘è¿™é‡Œåœ¨åˆ›å»ºäº†ä¸€ä¸ªåœ¨ tttæ± configæ•°æ®é›†ä¸‹çš„å«nvme-zvolçš„zvolï¼Œé‚£ä¹ˆè·¯å¾„å°±æ˜¯å›ºå®šçš„**/dev/zvol**+å‰é¢çš„é‚£äº›ï¼Œå¦‚ä¸‹ 12345/subsystems/testof/namespaces/1 set device path=/dev/zvol/ttt/config/nvme-zvol #åŒæ—¶enableè¿™ä¸ªnamespaces /subsystems/testof/namespaces/1 enable #ç»™testofè¿™ä¸ªsubsystemsé…ç½®å…è®¸ä»»ä½•é“¾æ¥ç”¨äºæµ‹è¯• /subsystems/testof/ set attr allow_any_host=1 åˆ°è¿™é‡Œç›®æ ‡é…ç½®å®Œæ¯•äº†ã€‚ è¿˜è¦é…ç½®ä¸€ä¸‹æœ¬æœºport 1234567#åˆ›å»ºä¸€ä¸ªport /ports create portid=1 #é…ç½®addrå’Œparamï¼Œæ›¿æ¢ä¸‹é¢ipåˆ°ä½ çš„æœ¬æœºip /ports/1/ set addr adrfam=ipv4 traddr=192.168.2.140 trtype=rdma trsvcid=4420 /ports/1/ set param inline_data_size=4096 #å¯åŠ¨subsystemï¼Œæ²¡æœ‰ä»»ä½•æŠ¥é”™å°±æ˜¯æˆåŠŸäº†ã€‚å¦‚æœæœ‰æŠ¥é”™ï¼Œçœ‹å†…æ ¸æ—¥å¿—èƒ½çœ‹åˆ°è¯¦ç»†é”™è¯¯ /ports/1/subsystems create testof æœ€ålsä¸€ä¸‹ 123456789101112131415/&gt; ls o- / .................................................................................... [...] o- hosts .............................................................................. [...] o- ports .............................................................................. [...] | o- 1 ............... [trtype=rdma, traddr=192.168.2.140, trsvcid=4420, inline_data_size=4096] | o- ana_groups ..................................................................... [...] | | o- 1 ................................................................ [state=optimized] | o- referrals ...................................................................... [...] | o- subsystems ..................................................................... [...] | o- testof .................................................................. [...] o- subsystems ......................................................................... [...] o- testof .................... [version=1.3, allow_any=1, serial=2cb2b6bc4b46653b7680] o- allowed_hosts .................................................................. [...] o- namespaces ..................................................................... [...] o- 1 [path=/dev/zvol/ttt/config/nvme-zvol, uuid=d88dc614-c22d-4942-8a97-5108f210aa1f, grpid=1, enabled] çœ‹ä¸€ä¸‹æ‰€æœ‰çš„é…ç½®ï¼Œå…¶å®ç›´æ¥æŒ‰ç…§è¿™ä¸ªé…ç½®å»é…å°±è¡Œäº†ã€‚ æˆ‘ä»¬æœ€åéœ€è¦ä¿å­˜ä¸€ä¸‹é…ç½®ä¸ºnvmet-config-loaded.json ï¼Œè®°ä½ä¸€å®šæ˜¯è¿™ä¸ªï¼Œå› ä¸ºè„šæœ¬ä¼šè‡ªåŠ¨åŠ è½½è¿™ä¸ªå‘½åçš„é…ç½®ï¼Œå¹¶ä¸”æ”¾åœ¨è„šæœ¬çš„åŒç›®å½• 1saveconfig nvmet-config-loaded.json ç„¶ååŠ è½½é…ç½®ï¼Œæ­¤æ—¶å°±åˆ›å»ºå®Œæˆäº† 1/mnt/CPool/myscripts/nvmet-venv/bin/python /root/.local/bin/nvmetcli restore nvmet-config-loaded.json åŠ å…¥è‡ªå¯åŠ¨ ä¸€å®šè¦æŠŠä¸‹é¢å‘½ä»¤åŠ å…¥å¼€æœºå¯åŠ¨ï¼Œè¿™æ ·å°±èƒ½è‡ªåŠ¨å®‰è£…ç¯å¢ƒå¹¶ä¸”åŠ è½½é…ç½® 1bash /mnt/CPool/myscripts/scale-nvmet-start.sh æµ‹è¯•æœºå™¨ è¿™é‡Œå°±ç®€è¿°äº†ï¼Œæ ¹æ®ä½ è‡ªå·±ç¯å¢ƒ é…ç½®ç¯å¢ƒ 12345apt update &amp;&amp; apt -y install nvme-cli #tcp modprobe nvme_tcp &amp;&amp; echo &quot;nvme_tcp&quot; &gt;&gt; /etc/modules-load.d/nvme_tcp.conf #rmda modprobe nvme_rdma &amp;&amp; echo &quot;nvme_rdma&quot; &gt;&gt; /etc/modules-load.d/nvme_tcp.conf æŸ¥æ‰¾ 1nvme discover -t rdma -a 192.168.2.140 -s 4420 é“¾æ¥ 1nvme connect -t rdma -n åˆšæ‰é‚£ä¸ªçˆ±å«ä»€ä¹ˆå«ä»€ä¹ˆçš„ -a 192.168.2.140 -s 4420 æŸ¥çœ‹ 12345nvme list #èƒ½çœ‹åˆ°ä¸€ä¸ªmodelæ˜¯linuxçš„ç¡¬ç›˜ï¼Œå°±æ˜¯nvmeofæŒ‚è½½çš„äº† Node Generic SN Model Namespace Usage Format FW Rev --------------------- --------------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- -------- /dev/nvme4n1 /dev/ng4n1 9c5bb3bf618c2999ef73 Linux 1 53.69 GB / 53.69 GB 512 B + 0 B 6.6.44-p æ–­å¼€é“¾æ¥ 1nvme disconnect -n åˆšæ‰é‚£ä¸ªçˆ±å«ä»€ä¹ˆå«ä»€ä¹ˆçš„ å‚è€ƒï¼š https://www.intel.com/content/dam/support/us/en/documents/network-and-i-o/fabric-products/Config_NVMe_on_Intel_OPA_AN_J78967_v3_0.pdf https://www.reddit.com/r/truenas/comments/1fh3rfl/an_idiots_walkthrough_to_setting_up_nvmeofroce/ https://linbit.com/blog/configuring-highly-available-nvme-of-attached-storage-in-proxmox-ve/ https://kb.blockbridge.com/technote/proxmox-iscsi-vs-nvmetcp/#","categories":[],"tags":[{"name":"TrueNAS","slug":"TrueNAS","permalink":"https://homelabproject.cc/tags/TrueNAS/"}]},{"title":"NFS over RDMA  TrueNAS","slug":"TrueNAS/NFS over RDMA  TrueNAS","date":"2025-01-01T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"TrueNAS/NFS over RDMA  TrueNAS/","permalink":"https://homelabproject.cc/TrueNAS/NFS%20over%20RDMA%20%20TrueNAS/","excerpt":"","text":"å…³é”® rpcrdmaæ¨¡å—åŠ è½½ /proc/fs/nfsd/portlistå†™å…¥rdmaç«¯å£ ä½ å¯ä»¥ç›´æ¥è¾“å…¥ä¸‹é¢å‘½ä»¤ä¸‹è½½è„šæœ¬å¹¶æ‰§è¡Œã€‚ 1curl -o ./load-nfs-rdma.sh https://file.homelabproject.cc/d/local/Server/Src/rdma-tools/load-nfs-rdma.sh æˆ–è€…è‡ªè¡Œç²˜è´´ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#!/bin/bash LOGFILE=&quot;/var/log/rdma_setup.log&quot; RDMA_PORT=${RDMA_PORT:-20049} # Redirect output to log file exec &gt; &gt;(tee -a &quot;$LOGFILE&quot;) 2&gt;&amp;1 echo &quot;Starting RDMA setup script at $(date)&quot; # Ensure script is run as root if [ &quot;$(id -u)&quot; -ne 0 ]; then echo &quot;This script must be run as root. Please re-run with sudo or as root user.&quot; &gt;&amp;2 exit 1 fi # Check if the rpcrdma module is available if ! modinfo rpcrdma &amp;&gt;/dev/null; then echo &quot;The rpcrdma module is not available on this system. Please ensure it is installed.&quot; &gt;&amp;2 exit 1 fi # Check if the rpcrdma module is loaded if ! lsmod | grep -q &quot;^rpcrdma&quot;; then echo &quot;The rpcrdma module is not loaded, loading it now...&quot; modprobe rpcrdma if [ $? -eq 0 ]; then echo &quot;The rpcrdma module was successfully loaded.&quot; else echo &quot;Failed to load the rpcrdma module. Please check permissions or module availability.&quot; &gt;&amp;2 exit 1 fi else echo &quot;The rpcrdma module is already loaded.&quot; fi # Check if /proc/fs/nfsd/portlist contains the RDMA port if ! grep -q &quot;rdma $RDMA_PORT&quot; /proc/fs/nfsd/portlist; then echo &quot;&#39;rdma $RDMA_PORT&#39; is not present in /proc/fs/nfsd/portlist, adding it now...&quot; echo &quot;rdma $RDMA_PORT&quot; &gt; /proc/fs/nfsd/portlist if [ $? -eq 0 ]; then echo &quot;&#39;rdma $RDMA_PORT&#39; was successfully added to /proc/fs/nfsd/portlist.&quot; else echo &quot;Failed to write to /proc/fs/nfsd/portlist. Please check permissions.&quot; &gt;&amp;2 exit 1 fi else echo &quot;&#39;rdma $RDMA_PORT&#39; is already present in /proc/fs/nfsd/portlist.&quot; fi #echo &quot;RDMA setup script completed successfully at $(date)&quot; å¦å¤–å¯ä»¥æ”¾å…¥å®šæ—¶ä»»åŠ¡ï¼Œè‡ªåŠ¨æ£€æµ‹æ¨¡å—åŠ è½½å’Œç«¯å£ï¼Œç¡®ä¿æœåŠ¡æ­£å¸¸","categories":[],"tags":[{"name":"TrueNAS","slug":"TrueNAS","permalink":"https://homelabproject.cc/tags/TrueNAS/"}]},{"title":"SMB 10G ä¼ è¾“æ–‡ä»¶æ’éš¾æŒ‡å—","slug":"Others/SMB 10G ä¼ è¾“æ–‡ä»¶æ’éš¾æŒ‡å—","date":"2024-10-09T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"Others/SMB 10G ä¼ è¾“æ–‡ä»¶æ’éš¾æŒ‡å—/","permalink":"https://homelabproject.cc/Others/SMB%2010G%20%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6%E6%8E%92%E9%9A%BE%E6%8C%87%E5%8D%97/","excerpt":"","text":"å…¥å…¥å…¥å…¥å…¥å…¥å…¥é—¨æ•™ç¨‹ç³»åˆ—ï¼Ÿ å‰æƒ…æè¦ å¾ˆå¤šäººåœ¨ç»„å®ŒNASï¼Œå°¤å…¶æ˜¯10Gå¾€ä¸Šå±€åŸŸç½‘æˆ–è€…ç›´è¿çš„ç”¨æˆ·ï¼Œç»å¸¸ä¼šé‡åˆ°SMBæ‹·è´ä¸€ä¸ªæ–‡ä»¶ï¼Œè¾¾ä¸åˆ°é¢„è®¡é€Ÿåº¦ï¼Œç„¶åé—®ï¼šâ€œæˆ‘è¿™ä¸ªNASç³»ç»Ÿï¼ˆä¸‡å…†ç½‘å¡ï¼‰æ€ä¹ˆè·‘ä¸æ»¡10Gï¼Ÿâ€ ï¼šâ€œï¼Ÿâ€œ è¿™ç¯‡æ–‡ç« ä¼šè®°å½•ä¸€äº›æœ€åŸºç¡€çš„æ’éš¾æ–¹å¼ã€‚åŒæ—¶è¿™ä¹Ÿèƒ½å­¦ä¼šå¦‚ä½•iperf3å’Œfioå‘½ä»¤ï¼Œä»¥åŠæŸ¥çœ‹PCIeè®¾å¤‡é€Ÿç‡ã€‚ åŸå› &amp;&amp;åˆ†æ å½“ä½ ä»æŒ‚è½½çš„SMBå…±äº«æ‹·è´åˆ°NASæˆ–è€…æœ¬åœ°ï¼Œå…¶å®ä¸­é—´æœ‰å¾ˆå¤šä¸ªç¯èŠ‚ã€‚ ä»¥NASé€šè¿‡10Gbpsç½‘å¡ç›´è¿PCï¼Œä»æœ¬åœ°å†™å…¥ä¸€ä¸ªæ–‡ä»¶åˆ°NASä¸ºä¾‹ï¼Œèƒ½è·‘åˆ°10Gbpséœ€è¦å¤§è‡´ä»¥ä¸‹çš„æ¡ä»¶ï¼š Windowsæœ¬åœ°ç£ç›˜çš„è¯»å–é€Ÿåº¦å¤§äºç­‰äº10Gbps Windowsæœ¬åœ°ç½‘å¡ï¼ˆä¸Šè¡Œï¼‰é€Ÿåº¦å¤§äºç­‰äº10Gbps NASç£ç›˜å†™å…¥å¤§äºç­‰äº10Gbps NASç½‘å¡ï¼ˆä¸‹è¡Œï¼‰å¤§äºç­‰äº10Gbps Windowsä»¥åŠNASæ»¡è¶³SMB 10Gbpså•æ ¸æ€§èƒ½ å…¶å®å¯ä»¥çœ‹åˆ°ï¼Œå¤§ä½“å°±æ˜¯ç£ç›˜é€Ÿåº¦+ç½‘é€Ÿï¼Œä½†æ˜¯å½±å“è¿™2ä¸ªå› ç´ çš„é—®é¢˜åˆæœ‰å¥½å¤šã€‚ è¿˜æœ‰ä¸€ç§æ¶æ„ï¼Œå³æœåŠ¡å™¨å’ŒPCå‡åœ¨10Gäº¤æ¢æœºä¸‹ï¼Œåˆ†åˆ«é€šè¿‡10Gé“¾æ¥åˆ°äº¤æ¢æœºï¼Œè™½ç„¶å¤šäº†äº¤æ¢æœºï¼Œä½†æ˜¯10Gäº¤æ¢æœºåŸºæœ¬ä¸ä¼šå¯¹ç¯å¢ƒé€ æˆæ¯”è¾ƒå¤§çš„å½±å“ï¼Œé™¤äº†è®°å¾—åœ¨å¼€å¯PCå’ŒNAS å·¨å¸§çš„åŒæ—¶ï¼Œäº¤æ¢æœºä¹Ÿè¦æ‰“å¼€å°±è¡Œã€‚ æµ‹è¯•æ–¹æ³• Windowsæœ¬åœ°ç£ç›˜çš„è¯»å–é€Ÿåº¦å¤§äºç­‰äº10Gbpsï¼Ÿ æµ‹è¯• https://crystalmark.info/en/software/crystaldiskmark/ è¯·ï¼è¿™è¿˜è¦æ•™ï¼Ÿä¸è¡Œå°±ç”¨å„ç§å·¥å…·ç®±é‡Œé¢çš„ã€‚ æ’éš¾ é¡ºåºè¯»å†™èƒ½å¤§äº1000MB/så°±è¶…è¿‡ä¸‡å…†ç½‘å¡é€Ÿç‡äº†ï¼Œå¤§éƒ¨åˆ†ä¸Šé¢è·‘ä¸åˆ°1000MB/sæ— éå°±æ˜¯SATA SSDå’Œæœºæ¢°ç¡¬ç›˜ï¼Œæ‰€ä»¥æ‹·è´æµ‹è¯•ä¸‡å…†çš„æ—¶å€™æŠŠç›®æ ‡ç¡¬ç›˜æˆ–è€…æºç¡¬ç›˜é€‰æ‹©ä¸ºNVMeç¡¬ç›˜å³å¯ã€‚ Windowsæœ¬åœ°ç½‘å¡ï¼ˆä¸Šè¡Œï¼‰é€Ÿåº¦å¤§äºç­‰äº10Gbps &amp;&amp; NASç½‘å¡ï¼ˆä¸‹è¡Œï¼‰å¤§äºç­‰äº10Gbpsï¼Ÿ æµ‹è¯• é¦–å…ˆï¼Œè¦ç”¨iperf3å·¥å…·ï¼Œiperf3çš„æµ‹è¯•æ˜¯çº¯ç½‘ç»œæµ‹è¯•å’Œç¡¬ç›˜é€Ÿåº¦æ— å…³ï¼Œæ‰€ä»¥èƒ½ç¡®å®šNASåˆ°Windowsçš„ç½‘ç»œååæ˜¯å¦è¾¾æ ‡ã€‚ ä¸‹è½½&amp;&amp;å®‰è£… Windowséœ€è¦è‡ªè¡Œä¸‹è½½å·¥å…· Windowså·¥å…·ä¸‹è½½ï¼š ï¼ˆå®˜ç½‘ï¼‰https://iperf.fr/download/windows/iperf-3.1.3-win64.zip ï¼ˆæœ¬ç«™ï¼‰https://alist.homelabproject.cc/d/local/Server/Tools/iperf-3.1.3-win64.zip NASç«¯å®‰è£…iperf3 Ubuntu/Debian(PVE/OMV) TrueNAS SCALE/COREä»¥åŠ UNRAIDè‡ªå¸¦æ— éœ€å®‰è£…ã€‚ 1apt update &amp;&amp; apt install iperf3 -y CentOS(è¿˜æœ‰äººç”¨ï¼Ÿä¼šç”¨å¾—ä¹Ÿä¸ç”¨æ•™å§ï¼ˆ 1yum install iperf3-y ç¾¤æ™–ç­‰å…¶ä»–æ²¡ç”¨è¿‡ç»™ä¸äº†æ•™ç¨‹ï¼Œè¿™è¾¹å»ºè®®â€ç™¾åº¦â€œã€‚ ä½¿ç”¨ iperf3å‘½ä»¤åˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œä½†æ˜¯åœ¨è¿™é‡Œçš„æµ‹è¯•ä¸­ï¼Œåœ¨å“ªè¾¹è·‘éƒ½è¡Œã€‚ä½†æ˜¯éœ€è¦å…ˆè¿è¡ŒæœåŠ¡ç«¯ã€‚ æœåŠ¡ç«¯ 1iperf3 -s -p 52239 è§£é‡Šï¼š -sï¼šä»£è¡¨è¿›å…¥æœåŠ¡ç«¯æ¨¡å¼ -pï¼šè¡¨ç¤ºæŒ‡å®šiperf3æœåŠ¡ç«¯å£ï¼Œå³ä½¿ä¸åŠ ä¼šæœ‰ä¸ªé»˜è®¤ç«¯å£ï¼Œä½†æ˜¯ä¸ºäº†é¿å…ç«¯å£å†²çªæˆ‘è¿™é‡Œåˆ¶å®šäº†ä¸€ä¸ªï¼Œå®é™…å¯ä»¥æ ¹æ®ä½ è‡ªå·±éšä¾¿ç»™ä¸ªæ•°å­—éƒ½è¡Œ å®¢æˆ·ç«¯ 1iperf -c 192.168.0.123 -p 52239 -P 5 -t 10 -d è§£é‡Šï¼š -cï¼šä»£è¡¨è¿›å…¥å®¢æˆ·ç«¯æ¨¡å¼ï¼Œéœ€è¦é“¾æ¥æœåŠ¡ç«¯ï¼Œåé¢çš„å‚æ•°192.168.0.123ï¼Œæ›¿æ¢æˆåˆšåˆšè¿è¡ŒæœåŠ¡ç«¯çš„IPåœ°å€å³å¯ -pï¼šæŒ‡å®šæœåŠ¡ç«¯çš„ç«¯å£ï¼Œéœ€è¦ä¸ä¸Šæ–¹æœåŠ¡ç«¯ç«¯å£ä¸€è‡´å³å¯ -Pï¼šä»£è¡¨çº¿ç¨‹æ•°ï¼Œå³åˆ°æœåŠ¡ç«¯å¹¶è¡Œçš„è¿æ¥æ•°ï¼Œè¿™è¾¹å»ºè®®ç…§æŠ„ç»™5å°±è¡Œï¼Œä¸€èˆ¬æ¥è¯´èƒ½è§£å†³å•çº¿ç¨‹è·‘ä¸æ»¡é—®é¢˜ï¼Œ5ä¸ªçº¿ç¨‹è·‘ä¸æ»¡10GåŸºæœ¬ç»™å¤šäº†ä¹Ÿæ²¡ç”¨ï¼ˆæ³¨æ„è¿™é‡Œçš„-Pæ˜¯å¤§å†™ï¼‰ -tï¼šä»£è¡¨è¿è¡Œæ—¶é—´ï¼ˆå•ä½æ˜¯ç§’ï¼‰ï¼Œ10ä»¥ä¸ŠåŸºæœ¬ç»“æœå·®è·ä¸å¤§äº†ï¼Œå¯ä»¥è‡ªè¡Œè°ƒæ•´æˆ–è€…æŠ„ä½œä¸š -dï¼šä»£è¡¨æµ‹è¯•åŒå‘ï¼Œå‘é€å’Œæ¥å— æ³¨æ„è¿™äº›å‘½ä»¤åœ¨NASç³»ç»Ÿ(Linux)å¯ä»¥ç›´æ¥æ‰§è¡Œ åœ¨Windowsä¸‹éœ€è¦å…ˆè§£å‹åˆšåˆšä¸‹è½½çš„å‹ç¼©åŒ…ï¼Œç„¶åWiné”®+Rè¾“å…¥cmdæ‰“å¼€å‘½ä»¤è¡Œ è¾“å…¥cd /ç›˜ç¬¦ &quot;iperf3è§£å‹å‡ºæ¥æ–‡ä»¶å¤¹çš„è·¯å¾„&quot;ï¼Œè·¯å¾„å¯ä»¥ç›´æ¥å¤åˆ¶windowsèµ„æºç®¡ç†å™¨ä¸Šæ–¹çš„åœ°å€ ä¾‹å¦‚ï¼š 1cd &quot;C:\\Users\\45251\\Downloads\\iperf-3.1.3-win64&quot; ç„¶åç”±ä¸Šæ–‡çš„å‘½ä»¤å¼€å¤´ â€iperf3â€œ å˜ä¸º â€.\\iperf3.exeâ€œï¼Œåé¢éƒ¨åˆ†ä¸€è‡´ æ•ˆæœå¦‚å›¾ï¼š åˆ†æç»“æœ æ‰§è¡Œå®Œå‘½ä»¤å°±èƒ½çœ‹åˆ°æœ€åçš„ç»“æœï¼Œå®ä¾‹å¦‚ä¸‹ï¼š â‘  Intervalè¡¨ç¤ºæ—¶é—´é—´éš”ã€‚ â‘¡ Transferè¡¨ç¤ºæ—¶é—´é—´éš”é‡Œé¢è½¬è¾“çš„æ•°æ®é‡ã€‚ â‘¢ Bandwidthæ˜¯æ—¶é—´é—´éš”é‡Œçš„ä¼ è¾“é€Ÿç‡ã€‚ è“è‰²æ¡†æ•°æ®æ˜¯æœ€ç»ˆçš„ç»“æœï¼Œä¹Ÿæ˜¯5ç»„æ•°æ®ï¼ˆ-P 5 å‚æ•°ï¼‰çš„å’Œï¼Œè€Œä¸”å› ä¸ºæˆ‘ä»¬è®¾ç½®äº†-dï¼Œæœ‰2ç»„æ•°æ®åˆ†åˆ«æ˜¯å‘é€ï¼ˆsenderï¼‰å’Œæ¥æ”¶(receiver)ã€‚é™¤æ­¤ä¹‹å¤–æœ‰10ç»„æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®äº†5ä¸ªçº¿ç¨‹+åŒæ—¶æµ‹è¯•åŒå‘ã€‚ å¯ä»¥çœ‹åˆ°åœ¨è“è‰²æ¡†é‡Œé¢æˆ‘ä»¬ä»¥åŠè·‘æ»¡äº†10Gbpsçš„å¸¦å®½ï¼Œè¯æ˜åœ¨ç½‘ç»œå¸¦å®½æ–¹é¢ï¼ŒWindowsåˆ°NASç«¯æ²¡ç”¨é—®é¢˜ æ’éš¾ é”™è¯¯ å¦‚æœç»“æœå¦‚ä¸‹ Transferåªæœ‰7.53GBytesä»¥åŠBandwidth6.47Gbits/secæ—¶ï¼Œå³ä»£è¡¨å¸¦å®½å‡ºç°äº†é—®é¢˜ã€‚é‚£ä¹ˆå°±éœ€è¦è¿›è¡Œæ’éš¾äº†ã€‚ ï¼ˆä½¿ç”¨äº†å¤šçº¿ç¨‹æµ‹é€Ÿï¼Œé‚£ä¹ˆå¾€å¾€æ˜¯å¦å¼€å¯å·¨å¸§å¯¹ç»“æœä¸ä¼šæœ‰å½±å“ï¼‰ ä»ç»éªŒæ¥çœ‹ï¼Œiperf3æµ‹è¯•æ— æ³•è·‘æ»¡å¤§æ¦‚ç‡æ˜¯å› ä¸ºä¸¤è¾¹çš„ç½‘å¡å…¶ä¸­ä¸€ç«¯çš„PCIeé€Ÿç‡æ— æ³•æ»¡è¶³ä¸‡å…†çš„éœ€æ±‚ã€‚å› ä¸ºå¾ˆå¤šç”¨æˆ·ä½¿ç”¨æ¶ˆè´¹çº§ä¸»æ¿éƒ½ä¼šæŠŠä¸‡å…†ç½‘å¡æ’åœ¨éç¬¬ä¸€æ§½ï¼Œè€Œå¾ˆå¤šå‚å•†æœ‰å–œæ¬¢æŠŠä»–ä»¬çš„æ¥è‡ªèŠ¯ç‰‡ç»„çš„PCIeX1 X4å¸¦å®½çš„æ’æ§½åšæˆX16çš„ç‰©ç†æ’æ§½æ¥â€æå‡æ‰©å±•æ€§â€œï¼Œå®é™…åªèƒ½è·‘åœ¨X1æˆ–è€…X4ã€‚ä½†æ˜¯å…¶å®PCIe2.0x4æˆ–è€…PCIe3.0x2ä»¥ä¸Šéƒ½å·²ç»èƒ½æ»¡è¶³ä¸‡å…†å•å£çš„éœ€æ±‚äº†ï¼Œå¤§éƒ¨åˆ†ä»”ç»†æŸ¥çœ‹ä¸»æ¿è¯´æ˜ä¹¦ï¼ŒåŸºæœ¬èƒ½çŸ¥é“ã€‚ å…³äºPCIeé€Ÿç‡èƒ½è·‘ä»€ä¹ˆé€Ÿåº¦ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„å›¾ï¼Œè®°å¾—ä¹˜ä»¥0.7å·¦å³çš„æŸè€—ï¼Œæ¯”å¦‚PCIe2.0X2å†™çš„1.00GB/sï¼Œå¥½åƒç†è®ºèƒ½è·‘ä¸‡å…†ï¼Œå®é™…åªèƒ½è·‘åœ¨6ã€700MB/så·¦å³çš„é€Ÿåº¦ å³ä½¿ä¸»æ¿å†™çš„å¾ˆæ¸…æ¥šï¼Œä½†æ˜¯ä¹Ÿä¸æ’é™¤ä¸€äº›é˜´é—´æƒ…å†µï¼Œæ¯”å¦‚ä½¿ç”¨ä¸€äº›å»¶é•¿çº¿ï¼Œæ‰PCIeé€Ÿç‡ï¼Œç”šè‡³æ˜¯é•¿åº¦ã€‚æ¯”å¦‚æˆ‘ä¹°åˆ°è¿‡ä¸€æ ¹æ ‡æ³¨M2è½¬PCIeX4çš„çº¿ï¼Œåªèƒ½æœ€é«˜è·‘åœ¨X2ï¼ˆï¼Ÿï¼‰ï¼Œå¯¼è‡´ä¸Š2.0å¡è·‘åœ¨PCIe2.0X2æ—¶å°±æ— æ³•è·‘æ»¡ä¸‡å…†å¸¦å®½ã€‚ æ‰€ä»¥æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯åœ¨ç³»ç»Ÿå†…æŸ¥çœ‹å½“å‰åå•†é€Ÿåº¦ã€‚ Windowsï¼šåœ¨â€œè®¾å¤‡ç®¡ç†å™¨â€ä¸­æ‰¾åˆ°ä½ çš„ç½‘å¡ï¼ŒåŒå‡»ç‚¹å¼€åï¼Œç‚¹å‡»è¯¦ç»†ä¿¡æ¯ï¼Œä¸‹æ¥å±æ€§æ¡†ï¼Œåº”è¯¥èƒ½æ‰¾åˆ°2ä¸ªå‚æ•°ï¼Œå¦‚ä¸‹2ä¸ªå‚æ•° PCIeå½“å‰é“¾è·¯å®½åº¦ä»£è¡¨PCIeæ§½çš„é•¿åº¦å³PCIeX(16/8/4/1) PCIeå½“å‰é“¾è·¯é€Ÿåº¦ä»£è¡¨PCIe(4/3/2).0 ä¾‹å¦‚ï¼š å³å½“å‰è®¾å¤‡è¿è¡Œåœ¨PCIe1.0 X4 ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„æ•°å€¼æ˜¯16è¿›åˆ¶ï¼Œä¸è¿‡ç½‘å¡éƒ½æ˜¯X4 X8çš„ï¼Œå°±ä¸ç”¨ç®¡å°±è¡Œï¼‰ å¦å¤–å¦‚æœæ˜¯Mellanoxçš„å¡ï¼Œæ˜¯å¯ä»¥åœ¨å±æ€§çš„informationé‡Œé¢ç›´æ¥çœ‹åˆ°é€Ÿç‡çš„ Linuxï¼š å…ˆæŸ¥çœ‹ä¸€ä¸‹ç½‘å¡ï¼Œæ‰¾åˆ°ä½ è‡ªå·±çš„ç½‘å¡ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘è¿™é‡Œçš„æ˜¯c2:00.0 1sudo lspci | grep -i eth æ‰€ä»¥å†ç”¨ä¸‹é¢å‘½ä»¤æŸ¥è¯¢c2:00.0çš„vendor idå’Œdevice id 1lspci -n | grep -i c2:00.0 æœ€åç”¨è¿™ä¸ªå‘½ä»¤å°±èƒ½æŸ¥è¯¢åˆ°å½“å‰çš„çš„é“¾æ¥é€Ÿåº¦ 1lspci -n -d 8086:10fb -vvv | grep -i width å¯ä»¥çœ‹åˆ°æˆ‘çš„é“¾æ¥é€Ÿåº¦(Speed)æ˜¯5GT/s, å®½åº¦ï¼ˆWidthï¼‰æ˜¯X8ï¼Œé“¾æ¥é€Ÿåº¦å¯ä»¥ç›´æ¥å¯¹åº”ä¸Šé¢çš„è¡¨ï¼Œå°±å¯ä»¥ç›´æ¥ç°åœ¨è¿™å¼ å¡è·‘åœ¨PCIe2.0x8ï¼Œå¸¦å®½æ˜¯æ²¡é—®é¢˜çš„ æŸ¥è¯¢çš„æ­¥éª¤å°±åˆ†ä¸ºè¿™2éƒ¨åˆ†ï¼Œå¦‚æœæœ‰ä¸€è¾¹ä½äºPCIe2.0x4æˆ–è€…PCIe3.0x2çš„è¯ï¼Œå°±ä»£è¡¨æ— æ³•è·‘æ»¡ä¸‡å…†ï¼Œéœ€è¦æ›´æ¢ä¸€ä¸ªPCIeä½ç½®ã€‚ NASç£ç›˜å†™å…¥å¤§äºç­‰äº10Gbpsï¼Ÿ æµ‹è¯• è¿™é‡Œè¦ç”¨åˆ°Fio æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ I/O å‹åŠ›æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥å¯¹ç¡¬ç›˜è¿›è¡Œé¡ºåºè¯»å†™æµ‹è¯•ã€‚ å®‰è£… Ubuntu/Debian(PVE/OMV) 1apt update &amp;&amp; apt install fio -y CentOS(è¿˜æœ‰äººç”¨ï¼Ÿä¼šç”¨å¾—ä¹Ÿä¸ç”¨æ•™å§ï¼ˆ 1yum install iperf3-y ä½¿ç”¨ å…ˆç”¨cd å‘½ä»¤è¿›å…¥ä½ è¦æµ‹è¯•çš„æ–‡ä»¶ç³»ç»Ÿæˆ–è€…é˜µåˆ— 1cd [éœ€è¦æµ‹è¯•çš„è·¯å¾„] ç„¶åä½¿ç”¨ä¸‹é¢å‘½ä»¤åˆ›å»ºä¸€ä¸ªFIOæµ‹è¯•æ–‡ä»¶çš„é…ç½®æ–‡ä»¶ 1234567891011cat &gt; test_disk_read.fio &lt;&lt;EOF [seq-read] name=Sequential Read Test ioengine=libaio iodepth=8 rw=read bs=1M size=10G numjobs=16 runtime=60 EOF 1234567891011cat &gt; test_disk_write.fio &lt;&lt;EOF [seq-write] name=Sequential Write Test ioengine=libaio iodepth=8 rw=write bs=1M size=10G numjobs=16 runtime=60 EOF ï¼ˆç…§æŠ„ä½œä¸šå°±è¡Œï¼Œå…³äºå…·ä½“å‚æ•°ï¼Œæ—¥åæ›´æ–°å§ã€‚ã€‚ï¼‰ å¼€å§‹æµ‹è¯• æµ‹è¯•è¯»å– 1fio test_disk_read.fio æµ‹è¯•å†™å…¥ 1fio test_disk_write.fio ï¼ˆæµ‹è¯•éœ€è¦ä¸€å®šæ—¶é—´ï¼‰ æœ€ååº”è¯¥æˆ‘ä»¬ä¼šå¾—åˆ°è¿™æ ·ä¸€ä¸ªæµ‹è¯•ç»“æœï¼ŒREADä»£è¡¨è¯»å–ï¼ŒWRITEä»£è¡¨å†™å…¥ï¼Œå¦‚æœ2è€…å‡è¶…è¿‡1000MiB/sï¼Œé‚£ä¹ˆåœ¨ä¸‡å…†ä¼ è¾“è¿™ä¸€ä¸ªé—®é¢˜åº”è¯¥ä¸ä¼šäº§ç”Ÿç“¶é¢ˆã€‚ 123Run status group 0 (all jobs): READ: bw=1072MiB/s (1124MB/s), 1072MiB/s-1072MiB/s (1124MB/s-1124MB/s), io=10.0GiB (10.7GB), run=9553-9553msec WRITE: bw=2003MiB/s (2100MB/s), 2003MiB/s-2003MiB/s (2100MB/s-2100MB/s), io=10.0GiB (10.7GB), run=5113-5113msec æ’éš¾ å…¶å®è¿™ä¸€éƒ¨åˆ†æ— éä¹Ÿå°±æ˜¯ä½ æœºæ¢°é˜µåˆ—çš„é—®é¢˜ï¼Œéœ€è¦ä¼˜åŒ–ä½ çš„é˜µåˆ—é€Ÿåº¦ï¼Œé‚£ä¸åŒæ–‡ä»¶ç³»ç»Ÿå°±ç›¸å·®ç”šè¿œï¼Œéœ€è¦è‡ªå·±è¿›è¡Œè°ƒæ•´ï¼Œè¿™é‡Œåªèƒ½å¸®å¿™å®šä½é—®é¢˜ã€‚ Windowsä»¥åŠNASæ»¡è¶³SMB 10Gbpså•æ ¸æ€§èƒ½ï¼Ÿ å…¶å®è¿™ä¹Ÿæ˜¯éå¸¸ç®€å•çš„ï¼ŒWindowsä¼ æ–‡ä»¶çš„æ—¶å€™æ‰“å¼€ä»»åŠ¡ç®¡ç†ï¼ŒæŸ¥çœ‹åœ¨è·‘ä¸æ»¡çš„æ—¶å€™ï¼Œæ˜¯å¦æœ‰ä¸€ä¸ªæ ¸å¿ƒè·‘æ»¡äº†ï¼Œé‚£å°±è¯æ˜å•æ ¸æ€§èƒ½ç“¶é¢ˆäº†ã€‚ï¼ˆ2023å¹´åº”è¯¥ä¸ä¼šæœ‰Uå•æ ¸è¿™æ ·ç“¶é¢ˆå§ï¼‰ æ€»ç»“ è¿™ç¯‡æ–‡ä»¶ç»™å‡ºäº†ä¸€ä¸ªæœ€åŸºç¡€é—®é¢˜çš„å®šä½æ–¹å¼ï¼Œä»¥åŠå‘½ä»¤ç®€å•çš„ç†è§£ï¼ŒåŸºæœ¬èƒ½è§£å†³97%ï¼ˆï¼Ÿï¼‰çš„é—®é¢˜ï¼Œåé¢å¯ä»¥è€ƒè™‘å†æ›´æ–°ä¸€ä¸‹FIOå‘½ä»¤çš„è¯¦ç»†è§£é‡Šï¼Œä¸è¿‡è¿™ä¸œè¥¿ç½‘ä¸Šä¸€å †ï¼Œè¿™é‡Œç»™å‡ºæ•™ç¨‹åªæ˜¯å¸Œæœ›ä½ åœ¨ç€æ€¥ä½¿ç”¨æ—¶èƒ½å¿«é€Ÿå­¦ä¼šï¼Œä¸ä¼šå› ä¸ºçœ‹ä¸€éæ–‡ç« ï¼Œè¦å»ç¿»å¥½å‡ ç¯‡æ‰èƒ½çœ‹æ‡‚ã€‚ å¼•ç”¨&amp;&amp;å¤‡æ³¨ https://en.wikipedia.org/wiki/PCI_Express â€œIcon made by Nikita Golubev from www.flaticon.comâ€ â€œIcon made by Pixel perfect from www.flaticon.comâ€","categories":[],"tags":[{"name":"Others","slug":"Others","permalink":"https://homelabproject.cc/tags/Others/"}]},{"title":"Proxmox VE (PVE) CT LXCå¤‡ä»½å¤±è´¥","slug":"Proxmox/Proxmox VE (PVE) CT LXCå¤‡ä»½å¤±è´¥","date":"2024-04-10T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"Proxmox/Proxmox VE (PVE) CT LXCå¤‡ä»½å¤±è´¥/","permalink":"https://homelabproject.cc/Proxmox/Proxmox%20VE%20(PVE)%20CT%20LXC%E5%A4%87%E4%BB%BD%E5%A4%B1%E8%B4%A5/","excerpt":"","text":"é—®é¢˜ åœ¨PVEä¸­ä½¿ç”¨NFSä½œä¸ºå­˜å‚¨ç»å¸¸ä¼šé‡åˆ°æƒé™é—®é¢˜ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨FakeNAS~~(TrueNAS SCALE)~~ NFSçš„å…±äº«ä½œä¸ºè™šæ‹Ÿæœºçš„å¤‡ä»½ï¼Œä½†æ˜¯ä¼šå‘ç°éç‰¹æƒå®¹å™¨éƒ½ä¼šå‡ºç°å¤‡ä»½å¤±è´¥çš„æƒ…å†µå…·ä½“æƒ…å†µå¦‚ä¸‹ 123456789101112131415161718192021222324252627INFO: starting new backup job: vzdump 112 --notes-template &#39;{{guestname}}&#39; --storage vm_omv --remove 0 --mode snapshot --compress zstd --node serverhub INFO: Starting Backup of VM 112 (lxc) INFO: Backup started at 2023-06-25 14:50:12 INFO: status = running INFO: CT Name: Nginx INFO: including mount point rootfs (&#39;/&#39;) in backup INFO: mode failure - some volumes do not support snapshots INFO: trying &#39;suspend&#39; mode instead INFO: backup mode: suspend INFO: ionice priority: 7 INFO: CT Name: Nginx INFO: including mount point rootfs (&#39;/&#39;) in backup INFO: temporary directory is on NFS, disabling xattr and acl support, consider configuring a local tmpdir via /etc/vzdump.conf INFO: starting first sync /proc/2982556/root/ to /mnt/pve/vm_omv/dump/vzdump-lxc-112-2023_06_25-14_50_12.tmp INFO: first sync finished - transferred 1.29G bytes in 61s INFO: suspending guest INFO: starting final sync /proc/2982556/root/ to /mnt/pve/vm_omv/dump/vzdump-lxc-112-2023_06_25-14_50_12.tmp INFO: final sync finished - transferred 1.05M bytes in 1s INFO: resuming guest INFO: guest is online again after 1 seconds INFO: creating vzdump archive &#39;/mnt/pve/vm_omv/dump/vzdump-lxc-112-2023_06_25-14_50_12.tar.zst&#39; INFO: tar: /mnt/pve/vm_omv/dump/vzdump-lxc-112-2023_06_25-14_50_12.tmp: Cannot open: Permission denied INFO: tar: Error is not recoverable: exiting now ERROR: Backup of VM 112 failed - command &#39;set -o pipefail &amp;&amp; lxc-usernsexec -m u:0:100000:65536 -m g:0:100000:65536 -- tar cpf - --totals --one-file-system -p --sparse --numeric-owner --acls --xattrs &#39;--xattrs-include=user.*&#39; &#39;--xattrs-include=security.capability&#39; &#39;--warning=no-file-ignored&#39; &#39;--warning=no-xattr-write&#39; --one-file-system &#39;--warning=no-file-ignored&#39; &#39;--directory=/mnt/pve/vm_omv/dump/vzdump-lxc-112-2023_06_25-14_50_12.tmp&#39; ./etc/vzdump/pct.conf ./etc/vzdump/pct.fw &#39;--directory=/mnt/pve/vm_omv/dump/vzdump-lxc-112-2023_06_25-14_50_12.tmp&#39; --no-anchored &#39;--exclude=lost+found&#39; --anchored &#39;--exclude=./tmp/?*&#39; &#39;--exclude=./var/tmp/?*&#39; &#39;--exclude=./var/run/?*.pid&#39; . | zstd --rsyncable &#39;--threads=1&#39; &gt;/mnt/pve/vm_omv/dump/vzdump-lxc-112-2023_06_25-14_50_12.tar.dat&#39; failed: exit code 2 INFO: Failed at 2023-06-25 14:51:25 INFO: Backup job finished with errors TASK ERROR: job errors å¯ä»¥çœ‹åˆ°æŠ¥é”™ä¸­æç¤ºå­˜å‚¨NFS æç¤ºæƒé™é™åˆ¶ åŸå› æ˜¯å› ä¸ºLXCä½¿ç”¨çš„æ˜¯érootç”¨æˆ·ï¼Œè€Œæˆ‘åœ¨TrueNASä½¿ç”¨Maproot Userä¼šä»…é™äºå®¢æˆ·ç«¯ï¼ˆPVEï¼‰çš„rootç”¨æˆ·æ˜ å°„åˆ°NFSæœåŠ¡ç«¯ï¼ˆTrueNASï¼‰çš„rootç”¨æˆ·çš„æƒé™ï¼Œå¯¼è‡´æƒé™å‡ºé”™ã€‚ è§£å†³æ–¹æ³• æ›´æ”¹å¤‡ä»½çš„ä¸´æ—¶ç›®å½•åˆ°ç³»ç»Ÿç›˜å°±èƒ½è½»æ¾ç§’æ€ï¼Œä½†æ˜¯æˆ‘çš„ç³»ç»Ÿç›˜æ˜¯16Gå‚²è…¾ï¼Œæ— æ³•æ”¯æ’‘ä¸´æ—¶å¤‡ä»½ï¼Œæ‰€ä»¥ä¸è¡Œã€‚ 1echo &quot;tmpdir: /tmp&quot; &gt;&gt; /etc/vzdump.conf å°†Maprootçš„é€‰é¡¹æ›´æ”¹åˆ°Mapallï¼Œå³ å°†â€œNFSæœåŠ¡å™¨å°†åœ¨å®¢æˆ·ç«¯è®¿é—®å…±äº«æ—¶å°†æ‰€æœ‰ç”¨æˆ·çš„æƒé™æ˜ å°„ä¸ºrootç”¨æˆ·çš„æƒé™ï¼Œä½†ä»…é™äºrootç”¨æˆ·â€æ›´æ”¹ä¸ºâ€œNFSæœåŠ¡å™¨å°†åœ¨å®¢æˆ·ç«¯è®¿é—®å…±äº«æ—¶å°†æ‰€æœ‰ç”¨æˆ·çš„æƒé™æ˜ å°„ä¸ºrootç”¨æˆ·çš„æƒé™ã€‚â€ã€‚è®©å®¢æˆ·ç«¯ï¼ˆPVEï¼‰érootæƒé™(éç‰¹æƒ)çš„LXCå®¹å™¨ä¹Ÿèƒ½æ˜ å°„ä¸ºNFSæœåŠ¡ç«¯ï¼ˆTrueNASï¼‰rootç”¨æˆ·ã€‚","categories":[],"tags":[{"name":"ProxmoxVE","slug":"ProxmoxVE","permalink":"https://homelabproject.cc/tags/ProxmoxVE/"}]},{"title":"TrueNAS SCALEï¼ˆNetwork UPS Toolsï¼‰ ä½¿ç”¨CyberPower UPS 10-20å°æ—¶ æ–­è¿","slug":"TrueNAS/TrueNAS CyberPower NUT (Network UPS Tools) æ–­è¿","date":"2023-05-21T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"TrueNAS/TrueNAS CyberPower NUT (Network UPS Tools) æ–­è¿/","permalink":"https://homelabproject.cc/TrueNAS/TrueNAS%20CyberPower%20NUT%20(Network%20UPS%20Tools)%20%E6%96%AD%E8%BF%9E/","excerpt":"","text":"åœ¨/usr/nut/ups.conf æˆ–è€…WebUI-ç³»ç»Ÿè®¾ç½®-æœåŠ¡-UPS-Auxiliary Parameters (ups.conf)ä¸­åŠ å…¥ 1pollonly = &quot;enabled&quot; ä¿å­˜ï¼Œé‡å¯upsæœåŠ¡å³å¯ å›¾ç¤ºï¼š å‚è€ƒæ¥æºï¼šhttps://github.com/networkupstools/nut/issues/1029","categories":[],"tags":[{"name":"TrueNAS","slug":"TrueNAS","permalink":"https://homelabproject.cc/tags/TrueNAS/"}]},{"title":"æ–‡ç« å½’æ¡£","slug":"Others/Posts","date":"1999-12-31T15:00:00.000Z","updated":"2025-06-19T04:44:26.917Z","comments":true,"path":"/posts/","permalink":"https://homelabproject.cc/posts/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"å‹é“¾","slug":"Others/å‹é“¾","date":"1900-12-31T15:00:00.000Z","updated":"2025-06-19T04:44:26.921Z","comments":true,"path":"Others/å‹é“¾/","permalink":"https://homelabproject.cc/Others/%E5%8F%8B%E9%93%BE/","excerpt":"","text":"","categories":[],"tags":[]}],"categories":[],"tags":[{"name":"SelfHosted","slug":"SelfHosted","permalink":"https://homelabproject.cc/tags/SelfHosted/"},{"name":"TrueNAS","slug":"TrueNAS","permalink":"https://homelabproject.cc/tags/TrueNAS/"},{"name":"Docker","slug":"Docker","permalink":"https://homelabproject.cc/tags/Docker/"},{"name":"Infra","slug":"Infra","permalink":"https://homelabproject.cc/tags/Infra/"},{"name":"Others","slug":"Others","permalink":"https://homelabproject.cc/tags/Others/"},{"name":"Incus","slug":"Incus","permalink":"https://homelabproject.cc/tags/Incus/"},{"name":"Hardware","slug":"Hardware","permalink":"https://homelabproject.cc/tags/Hardware/"},{"name":"RouterOS","slug":"RouterOS","permalink":"https://homelabproject.cc/tags/RouterOS/"},{"name":"ProxmoxVE","slug":"ProxmoxVE","permalink":"https://homelabproject.cc/tags/ProxmoxVE/"}]}
<!doctype html><html lang="zh"><head><title>SMB 10G 传输文件排难指南 - HomeLabProject</title><meta charset="UTF-8"><meta name="keywords" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><link rel="shortcut icon" href="/images/cloud.avif" type="image/x-icon"><meta name="description" content="入入入入入入入门教程系列？ 前情提要 很多人在组完NAS，尤其是10G往上局域网或者直连的用户，经常会遇到SMB拷贝一个文件，达不到预计速度，然后问：“我这个NAS系统（万兆网卡）怎么跑不满10G？” ：“？“ 这篇文章会记录一些最基础的排难方式。同时这也能学会如何iperf3和fio命令，以及查看PCIe设备速率。 原因&amp;&amp;分析 当你从挂载的SMB共享拷贝到NAS或者本地，其实中"><meta property="og:type" content="article"><meta property="og:title" content="SMB 10G 传输文件排难指南"><meta property="og:url" content="https://homelabproject.cc/Others/SMB%2010G%20%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6%E6%8E%92%E9%9A%BE%E6%8C%87%E5%8D%97/index.html"><meta property="og:site_name" content="HomeLabProject"><meta property="og:description" content="入入入入入入入门教程系列？ 前情提要 很多人在组完NAS，尤其是10G往上局域网或者直连的用户，经常会遇到SMB拷贝一个文件，达不到预计速度，然后问：“我这个NAS系统（万兆网卡）怎么跑不满10G？” ：“？“ 这篇文章会记录一些最基础的排难方式。同时这也能学会如何iperf3和fio命令，以及查看PCIe设备速率。 原因&amp;&amp;分析 当你从挂载的SMB共享拷贝到NAS或者本地，其实中"><meta property="og:locale"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/server2comp.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/sw.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/Untitled.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/Untitled%201.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/Untitled%202.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/Untitled%203.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/Untitled%204.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/Untitled%205.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/883787184.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/3873537587.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/Untitled%206.png"><meta property="og:image" content="https://homelabproject.cc/images/SMB-10G/Untitled%207.png"><meta property="article:published_time" content="2024-10-09T15:00:00.000Z"><meta property="article:modified_time" content="2025-05-30T01:48:31.420Z"><meta property="article:author" content="Channing He"><meta property="article:tag" content="Others"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://homelabproject.cc/images/SMB-10G/server2comp.png"><link rel="stylesheet" href="/lib/fancybox/fancybox.css"><link rel="stylesheet" href="/lib/mdui_043tiny/mdui.css"><link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1748569727524"><link rel="stylesheet" href="/css/style.css?v=1748569727524"><link rel="stylesheet" href="/custom.css?v=1748569727524"><script src="/lib/mdui_043tiny/mdui.js" async></script><script src="/lib/fancybox/fancybox.umd.js" async></script><script src="/lib/lax.min.js" async></script><script async src="/js/app.js?v=1748569727524"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-HPN9ZE6SCR"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HPN9ZE6SCR")</script><script defer src="/_vercel/speed-insights/script.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-shiki-plugin@latest/lib/codeblock.css"><style>:root{--hl-color:#abb2bf;--hl-bg:#282c34;--hltools-bg:#21252b;--hltools-color:#bbbbbc;--hlnumber-bg:#282c34;--hlnumber-color:#495162;--hlscrollbar-bg:#373c47;--hlexpand-bg:linear-gradient(180deg,rgba(40,44,52,0.1),rgba(40,44,52,0.9))}</style><meta name="generator" content="Hexo 7.3.0"></head><body class="nexmoe mdui-drawer-body-left"><div id="nexmoe-background"><div class="nexmoe-bg" style="background-image:url(/images/default.avif)"></div><div class="mdui-appbar mdui-shadow-0"><div class="mdui-toolbar"><a class="mdui-btn mdui-btn-icon mdui-ripple" mdui-drawer="{target: &#039;#drawer&#039;, swipe: true}" title="menu"><i class="mdui-icon nexmoefont icon-menu"></i></a><div class="mdui-toolbar-spacer"></div><a class="mdui-btn mdui-btn-icon" href="/" title="Channing He"><img src="/images/cloud.avif" alt="Channing He"></a></div></div></div><div id="nexmoe-header"><div class="nexmoe-drawer mdui-drawer" id="drawer"><div class="nexmoe-avatar mdui-ripple"><a href="/" title="Channing He"><img src="/images/cloud.avif" alt="Channing He" alt="Channing He"></a></div><div class="nexmoe-count"><div><span>Articles</span>13</div><div><span>Tags</span>8</div><div><span>Categories</span>0</div></div><div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}"><a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页"><i class="mdui-list-item-icon nexmoefont icon-home"></i><div class="mdui-list-item-content">回到首页</div></a><a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/posts/" title="文章列表"><i class="mdui-list-item-icon nexmoefont icon-container"></i><div class="mdui-list-item-content">文章列表</div></a><a class="nexmoe-list-item mdui-list-item mdui-ripple false" target="_blank" rel="noopener" href="https://file.homelabproject.cc/" title="云盘"><i class="mdui-list-item-icon nexmoefont icon-ellipsis"></i><div class="mdui-list-item-content">云盘</div></a><a class="nexmoe-list-item mdui-list-item mdui-ripple false" target="_blank" rel="noopener" href="https://github.com/tvvocold/How-To-Ask-Questions-The-Smart-Way/" title="提问的艺术"><i class="mdui-list-item-icon nexmoefont icon-info-circle"></i><div class="mdui-list-item-content">提问的艺术</div></a></div><div class="nexmoe-widget-wrap"><div class="nexmoe-widget nexmoe-search"><form id="search_form" action_e="https://cn.bing.com/search?q=site:homelabproject.cc" onsubmit="return search()"><label><input id="search_value" name="q" type="search" placeholder="Search"></label></form></div></div><div class="nexmoe-widget-wrap"><div class="nexmoe-widget nexmoe-social"><a class="mdui-ripple" href="https://qm.qq.com/q/7pRlgcBzhY" target="_blank" mdui-tooltip="{content: '大佬的QQ群'}" style="color:#f9ae08;background-color:rgba(249,174,8,.1)"><i class="nexmoefont icon-QQ"></i></a></div></div><div class="nexmoe-widget-wrap"><div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow"><a href="/tags/Docker/" style="font-size:15px">Docker</a> <a href="/tags/Hardware/" style="font-size:10px">Hardware</a> <a href="/tags/Incus/" style="font-size:10px">Incus</a> <a href="/tags/Infra/" style="font-size:15px">Infra</a> <a href="/tags/Others/" style="font-size:15px">Others</a> <a href="/tags/ProxmoxVE/" style="font-size:10px">ProxmoxVE</a> <a href="/tags/RouterOS/" style="font-size:10px">RouterOS</a> <a href="/tags/TrueNAS/" style="font-size:20px">TrueNAS</a></div><script>for(var maxTagcloud=parseInt(17),tags_length=parseInt(8),tags_arr=[],i=0;i<tags_length;i++)tags_arr.push(i);tags_arr.sort((function(a,t){return Math.random()>.5?-1:1})),tags_arr=tags_arr.slice(0,maxTagcloud<tags_length?tags_length-maxTagcloud:0);for(var tag_i=0;tag_i<tags_arr.length;tag_i++)document.getElementById("randomtagcloud").children[tags_arr[tag_i]].style.display="none"</script></div><div class="nexmoe-widget-wrap"><h3 class="nexmoe-widget-title">Recent Posts</h3><div class="nexmoe-widget"><ul><li><a href="/Infra/Hexo%20Blog%E6%96%B9%E6%A1%88/">Hexo Blog方案</a></li><li><a href="/Infra/%E8%87%AA%E5%BB%BA%20APT%20%E9%95%9C%E5%83%8F%E6%BA%90%20Tunasync%20CRON%E5%AE%9A%E6%97%B6%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/">自建 APT 镜像源 Tunasync CRON定时 多线程</a></li><li><a href="/TrueNAS/TrueNAS%2025.04%20%20Docker%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%EF%BC%88%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90UID%E7%AF%87%EF%BC%89/">TrueNAS 25.04 Docker最佳实践（文件权限篇）</a></li><li><a href="/Others/Mellanox%20SN2700%20%E9%A3%8E%E6%89%87%20%E6%94%B9%E9%80%A0/">Mellanox SN2700 风扇 改造</a></li><li><a href="/TrueNAS/TrueNAS%20%E6%97%A5%E5%BF%97%E8%BF%87%E5%A4%9A%20debug/">TrueNAS 日志过多</a></li></ul></div></div><div class="nexmoe-widget-wrap"><div class="nexmoe-widget nexmoe-link"><ul><li><a href="https://homelabproject.cc/" target="_blank"><img src="/images/notenterprise.avif" alt="你家不开IDC吗？"><p>你家不开IDC吗？</p></a></li></ul></div></div><style>.nexmoe-widget-wrap .nexmoe-link ul li a{text-align:center}.nexmoe-widget-wrap .nexmoe-link ul li a img{max-width:100%}.nexmoe-widget-wrap .nexmoe-link ul li a p{margin:10px 0}</style><div class="nexmoe-copyright">&copy; 2025 Channing He Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a><br><a target="_blank" href="https://homelabproject.cc/">HomieLab</a></div></div></div><div id="nexmoe-content"><div class="nexmoe-primary"><div class="nexmoe-post"><article><div class="nexmoe-post-cover"><img src="/images/default.avif" alt="SMB 10G 传输文件排难指南" loading="lazy"><h1>SMB 10G 传输文件排难指南</h1></div><div class="nexmoe-post-meta"><div class="nexmoe-rainbow"><a class="nexmoefont icon-calendar-fill">2024年10月10日</a></div></div><p>入入入入入入入门教程系列？</p><h1>前情提要</h1><p>很多人在组完NAS，尤其是10G往上局域网或者直连的用户，经常会遇到SMB拷贝一个文件，达不到预计速度，然后问：“我这个NAS系统（万兆网卡）怎么跑不满10G？”</p><p>：“？“</p><p>这篇文章会记录一些最基础的排难方式。同时这也能学会如何iperf3和fio命令，以及查看PCIe设备速率。</p><h1>原因&amp;&amp;分析</h1><p>当你从挂载的SMB共享拷贝到NAS或者本地，其实中间有很多个环节。</p><blockquote><p>以NAS通过10Gbps网卡直连PC，从本地写入一个文件到NAS为例，能跑到10Gbps需要大致以下的条件：</p></blockquote><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/server2comp.png" alt="server2comp.png" data-caption="server2comp.png" loading="lazy"></p><ul><li>Windows本地磁盘的读取速度大于等于10Gbps</li><li>Windows本地网卡（上行）速度大于等于10Gbps</li><li>NAS磁盘写入大于等于10Gbps</li><li>NAS网卡（下行）大于等于10Gbps</li><li>Windows以及NAS满足SMB 10Gbps单核性能</li></ul><p>其实可以看到，大体就是磁盘速度+网速，但是影响这2个因素的问题又有好多。</p><blockquote><p>还有一种架构，即服务器和PC均在10G交换机下，分别通过10G链接到交换机，虽然多了交换机，但是10G交换机基本不会对环境造成比较大的影响，除了记得在开启PC和NAS 巨帧的同时，交换机也要打开就行。</p></blockquote><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/sw.png" alt="sw.png" data-caption="sw.png" loading="lazy"></p><h1>测试方法</h1><h2 id="Windows本地磁盘的读取速度大于等于10Gbps？">Windows本地磁盘的读取速度大于等于10Gbps？</h2><h3 id="测试">测试</h3><p><a target="_blank" rel="noopener" href="https://crystalmark.info/en/software/crystaldiskmark/">https://crystalmark.info/en/software/crystaldiskmark/</a></p><p>请！这还要教？不行就用各种工具箱里面的。</p><h3 id="排难">排难</h3><p>顺序读写能大于1000MB/s就超过万兆网卡速率了，大部分上面跑不到1000MB/s无非就是SATA SSD和机械硬盘，所以拷贝测试万兆的时候把目标硬盘或者源硬盘选择为NVMe硬盘即可。</p><h2 id="Windows本地网卡（上行）速度大于等于10Gbps-NAS网卡（下行）大于等于10Gbps？">Windows本地网卡（上行）速度大于等于10Gbps &amp;&amp; NAS网卡（下行）大于等于10Gbps？</h2><h3 id="测试-2">测试</h3><p>首先，要用iperf3工具，iperf3的测试是纯网络测试和硬盘速度无关，所以能确定NAS到Windows的网络吞吐是否达标。</p><ol><li>下载&amp;&amp;安装</li></ol><p>Windows需要自行下载工具</p><blockquote><p>Windows工具下载：</p><p>（官网）<a target="_blank" rel="noopener" href="https://iperf.fr/download/windows/iperf-3.1.3-win64.zip">https://iperf.fr/download/windows/iperf-3.1.3-win64.zip</a></p><p>（本站）<a target="_blank" rel="noopener" href="https://alist.homelabproject.cc/d/local/Server/Tools/iperf-3.1.3-win64.zip">https://alist.homelabproject.cc/d/local/Server/Tools/iperf-3.1.3-win64.zip</a></p></blockquote><p>NAS端安装iperf3</p><blockquote><p>Ubuntu/Debian(PVE/OMV)<br>TrueNAS SCALE/CORE以及 UNRAID自带无需安装。</p></blockquote><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">apt</span><span style="color:#90a4ae"> </span><span style="color:#91b859">update</span><span style="color:#90a4ae"> </span><span style="color:#39adb5">&amp;&amp;</span><span style="color:#90a4ae"> </span><span style="color:#e2931d">apt</span><span style="color:#90a4ae"> </span><span style="color:#91b859">install</span><span style="color:#90a4ae"> </span><span style="color:#91b859">iperf3</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-y</span></span></code></pre></div></div></figure><blockquote><p>CentOS(还有人用？会用得也不用教吧（</p></blockquote><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">yum</span><span style="color:#90a4ae"> </span><span style="color:#91b859">install</span><span style="color:#90a4ae"> </span><span style="color:#91b859">iperf3-y</span></span></code></pre></div></div></figure><p>群晖等其他没用过给不了教程，这边建议”百度“。</p><ol><li>使用</li></ol><p>iperf3命令分为服务端和客户端，但是在这里的测试中，在哪边跑都行。但是需要先运行服务端。</p><p><strong>服务端</strong></p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">iperf3</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-s</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-p</span><span style="color:#90a4ae"> </span><span style="color:#f76d47">52239</span></span></code></pre></div></div></figure><blockquote><p>解释：</p><p>-s：代表进入服务端模式</p><p>-p：表示指定iperf3服务端口，即使不加会有个默认端口，但是为了避免端口冲突我这里制定了一个，实际可以根据你自己随便给个数字都行</p></blockquote><p><strong>客户端</strong></p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">iperf</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-c</span><span style="color:#90a4ae"> </span><span style="color:#f76d47">192.168</span><span style="color:#91b859">.0.123</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-p</span><span style="color:#90a4ae"> </span><span style="color:#f76d47">52239</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-P</span><span style="color:#90a4ae"> </span><span style="color:#f76d47">5</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-t</span><span style="color:#90a4ae"> </span><span style="color:#f76d47">10</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-d</span></span></code></pre></div></div></figure><blockquote><p>解释：</p><p>-c：代表进入客户端模式，需要链接服务端，后面的参数<code>192.168.0.123</code>，替换成刚刚运行服务端的IP地址即可</p><p>-p：指定服务端的端口，需要与上方服务端端口一致即可</p><p>-P：代表线程数，即到服务端并行的连接数，这边建议照抄给5就行，一般来说能解决单线程跑不满问题，5个线程跑不满10G基本给多了也没用（注意这里的-P是大写）</p><p>-t：代表运行时间（单位是秒），10以上基本结果差距不大了，可以自行调整或者抄作业</p><p>-d：代表测试双向，发送和接受</p></blockquote><ul><li><p>注意这些命令在NAS系统(Linux)可以直接执行</p></li><li><p>在Windows下需要先解压刚刚下载的压缩包，然后Win键+R输入cmd打开命令行</p><p>输入<code>cd /盘符 &quot;iperf3解压出来文件夹的路径&quot;</code>，路径可以直接复制windows资源管理器上方的地址</p><p>例如：</p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/Untitled.png" alt="Untitled" data-caption="Untitled" loading="lazy"></p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#6182b8">cd</span><span style="color:#90a4ae">  </span><span style="color:#39adb5">&quot;</span><span style="color:#91b859">C:\Users\45251\Downloads\iperf-3.1.3-win64</span><span style="color:#39adb5">&quot;</span></span></code></pre></div></div></figure><p>然后由上文的命令开头 ”<code>iperf3</code>“ 变为 ”<code>.\iperf3.exe</code>“，后面部分一致</p><p>效果如图：</p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/Untitled%201.png" alt="Untitled" data-caption="Untitled" loading="lazy"></p></li></ul><ol><li>分析结果</li></ol><p>执行完命令就能看到最后的结果，实例如下：</p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/Untitled%202.png" alt="Untitled" data-caption="Untitled" loading="lazy"></p><p>① Interval表示时间间隔。</p><p>② Transfer表示时间间隔里面转输的数据量。</p><p>③ Bandwidth是时间间隔里的传输速率。</p><p>蓝色框数据是最终的结果，也是5组数据（<code>-P 5</code> 参数）的和，而且因为我们设置了<code>-d</code>，有2组数据分别是发送（sender）和接收(receiver)。除此之外有10组数据，因为我们设置了5个线程+同时测试双向。</p><p>可以看到在蓝色框里面我们以及跑满了10Gbps的带宽，证明在网络带宽方面，Windows到NAS端没用问题</p><h3 id="排难-2">排难</h3><blockquote><p>错误</p><p>如果结果如下</p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/Untitled%203.png" alt="Untitled" data-caption="Untitled" loading="lazy"></p><p>Transfer只有7.53GBytes以及Bandwidth6.47Gbits/sec时，即代表带宽出现了问题。那么就需要进行排难了。</p></blockquote><p>（使用了多线程测速，那么往往是否开启巨帧对结果不会有影响）</p><p>从经验来看，iperf3测试无法跑满大概率是因为两边的网卡其中一端的PCIe速率无法满足万兆的需求。因为很多用户使用消费级主板都会把万兆网卡插在非第一槽，而很多厂商有喜欢把他们的来自芯片组的PCIeX1 X4带宽的插槽做成X16的物理插槽来”提升扩展性“，实际只能跑在X1或者X4。但是其实<strong>PCIe2.0x4或者PCIe3.0x2以上</strong>都已经能满足万兆单口的需求了，大部分仔细查看主板说明书，基本能知道。</p><blockquote><p>关于PCIe速率能跑什么速度，可以参考下面的图，记得乘以0.7左右的损耗，比如PCIe2.0X2写的1.00GB/s，好像理论能跑万兆，实际只能跑在6、700MB/s左右的速度</p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/Untitled%204.png" alt="Untitled" data-caption="Untitled" loading="lazy"></p></blockquote><p>即使主板写的很清楚，但是也不排除一些阴间情况，比如使用一些延长线，掉PCIe速率，甚至是长度。比如我买到过一根标注M2转PCIeX4的线，只能最高跑在X2（？），导致上2.0卡跑在PCIe2.0X2时就无法跑满万兆带宽。</p><p>所以最方便的方法是在系统内查看当前协商速度。</p><blockquote><p>Windows：在“设备管理器”中找到你的网卡，双击点开后，点击详细信息，下来属性框，应该能找到2个参数，如下2个参数</p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/Untitled%205.png" alt="Untitled" data-caption="Untitled" loading="lazy"></p><p>PCIe当前链路宽度代表PCIe槽的长度即PCIeX(16/8/4/1)</p><p>PCIe当前链路速度代表PCIe(4/3/2).0</p><p><strong>例如：</strong></p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/883787184.png" alt="883787184.png" data-caption="883787184.png" loading="lazy"></p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/3873537587.png" alt="3873537587.png" data-caption="3873537587.png" loading="lazy"></p><p>即当前设备运行在<code>PCIe1.0 X4</code></p><p>（需要注意的是这里的数值是16进制，不过网卡都是X4 X8的，就不用管就行）</p><p>另外如果是Mellanox的卡，是可以在属性的information里面直接看到速率的</p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/Untitled%206.png" alt="Untitled" data-caption="Untitled" loading="lazy"></p></blockquote><blockquote><p>Linux：</p><p><img onerror="imgOnError(this)" data-fancybox="gallery" src="../../images/SMB-10G/Untitled%207.png" alt="Untitled" data-caption="Untitled" loading="lazy"></p><p>先查看一下网卡，找到你自己的网卡，可以看到我这里的是c2:00.0</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">sudo</span><span style="color:#90a4ae"> </span><span style="color:#91b859">lspci</span><span style="color:#90a4ae"> </span><span style="color:#39adb5">|</span><span style="color:#90a4ae"> </span><span style="color:#e2931d">grep</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-i</span><span style="color:#90a4ae"> </span><span style="color:#91b859">eth</span></span></code></pre></div></div></figure><p>所以再用下面命令查询c2:00.0的vendor id和device id</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">lspci</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-n</span><span style="color:#90a4ae"> </span><span style="color:#39adb5">|</span><span style="color:#90a4ae"> </span><span style="color:#e2931d">grep</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-i</span><span style="color:#90a4ae"> </span><span style="color:#91b859">c2:00.0</span></span></code></pre></div></div></figure><p>最后用这个命令就能查询到当前的的链接速度</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">lspci</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-n</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-d</span><span style="color:#90a4ae"> </span><span style="color:#f76d47">8086</span><span style="color:#91b859">:10fb</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-vvv</span><span style="color:#90a4ae"> </span><span style="color:#39adb5">|</span><span style="color:#90a4ae"> </span><span style="color:#e2931d">grep</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-i</span><span style="color:#90a4ae"> </span><span style="color:#91b859">width</span></span></code></pre></div></div></figure><p>可以看到我的链接速度(Speed)是5GT/s, 宽度（Width）是X8，链接速度可以直接对应上面的表，就可以直接现在这张卡跑在PCIe2.0x8，带宽是没问题的</p></blockquote><p>查询的步骤就分为这2部分，如果有一边低于<strong>PCIe2.0x4或者PCIe3.0x2</strong>的话，就代表无法跑满万兆，需要更换一个PCIe位置。</p><h2 id="NAS磁盘写入大于等于10Gbps？">NAS磁盘写入大于等于10Gbps？</h2><h3 id="测试-3">测试</h3><p>这里要用到Fio 是一个功能强大的 I/O 压力测试工具，可以对硬盘进行顺序读写测试。</p><ol><li>安装</li></ol><blockquote><p>Ubuntu/Debian(PVE/OMV)</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">apt</span><span style="color:#90a4ae"> </span><span style="color:#91b859">update</span><span style="color:#90a4ae"> </span><span style="color:#39adb5">&amp;&amp;</span><span style="color:#90a4ae"> </span><span style="color:#e2931d">apt</span><span style="color:#90a4ae"> </span><span style="color:#91b859">install</span><span style="color:#90a4ae"> </span><span style="color:#91b859">fio</span><span style="color:#90a4ae"> </span><span style="color:#91b859">-y</span></span></code></pre></div></div></figure></blockquote><blockquote><p>CentOS(还有人用？会用得也不用教吧（</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">yum</span><span style="color:#90a4ae"> </span><span style="color:#91b859">install</span><span style="color:#90a4ae"> </span><span style="color:#91b859">iperf3-y</span></span></code></pre></div></div></figure></blockquote><ol start="2"><li>使用</li></ol><p>先用cd 命令进入你要测试的文件系统或者阵列</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#6182b8">cd</span><span style="color:#90a4ae"> [需要测试的路径]</span></span></code></pre></div></div></figure><p>然后使用下面命令创建一个FIO测试文件的配置文件</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">cat</span><span style="color:#90a4ae"> </span><span style="color:#39adb5">&gt;</span><span style="color:#90a4ae"> </span><span style="color:#91b859">test_disk_read.fio</span><span style="color:#90a4ae"> </span><span style="color:#39adb5">&lt;&lt;</span><span style="color:#39adb5">EOF</span></span>
<span class="line"><span style="color:#91b859">[seq-read]</span></span>
<span class="line"><span style="color:#91b859">name=Sequential Read Test</span></span>
<span class="line"><span style="color:#91b859">ioengine=libaio</span></span>
<span class="line"><span style="color:#91b859">iodepth=8</span></span>
<span class="line"><span style="color:#91b859">rw=read</span></span>
<span class="line"><span style="color:#91b859">bs=1M</span></span>
<span class="line"><span style="color:#91b859">size=10G</span></span>
<span class="line"><span style="color:#91b859">numjobs=16</span></span>
<span class="line"><span style="color:#91b859">runtime=60</span></span>
<span class="line"><span style="color:#39adb5">EOF</span></span></code></pre></div></div></figure><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">cat</span><span style="color:#90a4ae"> </span><span style="color:#39adb5">&gt;</span><span style="color:#90a4ae"> </span><span style="color:#91b859">test_disk_write.fio</span><span style="color:#90a4ae"> </span><span style="color:#39adb5">&lt;&lt;</span><span style="color:#39adb5">EOF</span></span>
<span class="line"><span style="color:#91b859">[seq-write]</span></span>
<span class="line"><span style="color:#91b859">name=Sequential Write Test</span></span>
<span class="line"><span style="color:#91b859">ioengine=libaio</span></span>
<span class="line"><span style="color:#91b859">iodepth=8</span></span>
<span class="line"><span style="color:#91b859">rw=write</span></span>
<span class="line"><span style="color:#91b859">bs=1M</span></span>
<span class="line"><span style="color:#91b859">size=10G</span></span>
<span class="line"><span style="color:#91b859">numjobs=16</span></span>
<span class="line"><span style="color:#91b859">runtime=60</span></span>
<span class="line"><span style="color:#39adb5">EOF</span></span></code></pre></div></div></figure><p>（照抄作业就行，关于具体参数，日后更新吧。。）</p><ol><li>开始测试</li></ol><p>测试读取</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">fio</span><span style="color:#90a4ae"> </span><span style="color:#91b859">test_disk_read.fio</span></span></code></pre></div></div></figure><p>测试写入</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">fio</span><span style="color:#90a4ae"> </span><span style="color:#91b859">test_disk_write.fio</span></span></code></pre></div></div></figure><p>（测试需要一定时间）</p><p>最后应该我们会得到这样一个测试结果，READ代表读取，WRITE代表写入，如果2者均超过1000MiB/s，那么在万兆传输这一个问题应该不会产生瓶颈。</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki material-theme-lighter"><code><span class="line"><span style="color:#e2931d">Run</span><span style="color:#90a4ae"> </span><span style="color:#91b859">status</span><span style="color:#90a4ae"> </span><span style="color:#91b859">group</span><span style="color:#90a4ae"> </span><span style="color:#f76d47">0</span><span style="color:#90a4ae"> (all </span><span style="color:#91b859">jobs</span><span style="color:#90a4ae">):</span></span>
<span class="line"><span style="color:#90a4ae">   </span><span style="color:#e2931d">READ:</span><span style="color:#90a4ae"> </span><span style="color:#91b859">bw=</span><span style="color:#f76d47">1072</span><span style="color:#91b859">MiB/s</span><span style="color:#90a4ae"> (1124MB/s), 1072MiB/s-1072MiB/s </span><span style="color:#39adb5">(</span><span style="color:#e2931d">1124MB/s-1124MB/s</span><span style="color:#39adb5">)</span><span style="color:#90a4ae">, io=10.0GiB </span><span style="color:#39adb5">(</span><span style="color:#e2931d">10.7GB</span><span style="color:#39adb5">)</span><span style="color:#90a4ae">, run=9553-9553msec</span></span>
<span class="line"><span style="color:#90a4ae">  </span><span style="color:#e2931d">WRITE:</span><span style="color:#90a4ae"> </span><span style="color:#91b859">bw=</span><span style="color:#f76d47">2003</span><span style="color:#91b859">MiB/s</span><span style="color:#90a4ae"> (2100MB/s), 2003MiB/s-2003MiB/s </span><span style="color:#39adb5">(</span><span style="color:#e2931d">2100MB/s-2100MB/s</span><span style="color:#39adb5">)</span><span style="color:#90a4ae">, io=10.0GiB </span><span style="color:#39adb5">(</span><span style="color:#e2931d">10.7GB</span><span style="color:#39adb5">)</span><span style="color:#90a4ae">, run=5113-5113msec</span></span></code></pre></div></div></figure><h3 id="排难-3">排难</h3><p>其实这一部分无非也就是你机械阵列的问题，需要优化你的阵列速度，那不同文件系统就相差甚远，需要自己进行调整，这里只能帮忙定位问题。</p><h2 id="Windows以及NAS满足SMB-10Gbps单核性能？">Windows以及NAS满足SMB 10Gbps单核性能？</h2><p>其实这也是非常简单的，Windows传文件的时候打开任务管理，查看在跑不满的时候，是否有一个核心跑满了，那就证明单核性能瓶颈了。（2023年应该不会有U单核这样瓶颈吧）</p><h1>总结</h1><p>这篇文件给出了一个最基础问题的定位方式，以及命令简单的理解，基本能解决97%（？）的问题，后面可以考虑再更新一下FIO命令的详细解释，不过这东西网上一堆，这里给出教程只是希望你在着急使用时能快速学会，不会因为看一遍文章，要去翻好几篇才能看懂。</p><h3 id="引用-备注">引用&amp;&amp;备注</h3><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/PCI_Express">https://en.wikipedia.org/wiki/PCI_Express</a></p><p>“Icon made by Nikita Golubev from <a target="_blank" rel="noopener" href="http://www.flaticon.com/">www.flaticon.com</a>”</p><p>“Icon made by <a target="_blank" rel="noopener" href="https://www.flaticon.com/authors/pixel-perfect">Pixel perfect</a> from <a target="_blank" rel="noopener" href="http://www.flaticon.com/">www.flaticon.com</a>”</p><p><img src="/images/logo1.png" loading="lazy"></p></article><div class="nexmoe-post-copyright"><strong>Author：</strong>Channing He<br><strong>Link：</strong><a href="https://homelabproject.cc/Others/SMB%2010G%20%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6%E6%8E%92%E9%9A%BE%E6%8C%87%E5%8D%97/" title="https:&#x2F;&#x2F;homelabproject.cc&#x2F;Others&#x2F;SMB%2010G%20%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6%E6%8E%92%E9%9A%BE%E6%8C%87%E5%8D%97&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;homelabproject.cc&#x2F;Others&#x2F;SMB%2010G%20%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6%E6%8E%92%E9%9A%BE%E6%8C%87%E5%8D%97&#x2F;</a><br><strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可</div><div class="nexmoe-post-meta nexmoe-rainbow"><a class="nexmoefont icon-tag-fill -none-link" href="/tags/Others/" rel="tag">Others</a></div><script async src="/js/copy-codeblock.js?v=1748569727421"></script><div class="nexmoe-post-footer"><script src="https://giscus.app/client.js" data-repo="ChanningHe/hlpj-hexo" data-repo-id="R_kgDOOuV1-Q" data-category="General" data-category-id="DIC_kwDOOuV1-c4CqgOV" data-mapping="title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async></script></div></div></div><div class="nexmoe-post-right"><div class="nexmoe-fixed"><div class="nexmoe-tool"><button class="mdui-fab catalog" style="overflow:unset"><i class="nexmoefont icon-i-catalog"></i><div class="nexmoe-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">前情提要</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">原因&amp;&amp;分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">测试方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows%E6%9C%AC%E5%9C%B0%E7%A3%81%E7%9B%98%E7%9A%84%E8%AF%BB%E5%8F%96%E9%80%9F%E5%BA%A6%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E10Gbps%EF%BC%9F"><span class="toc-number">3.1.</span> <span class="toc-text">Windows本地磁盘的读取速度大于等于10Gbps？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">3.1.1.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E9%9A%BE"><span class="toc-number">3.1.2.</span> <span class="toc-text">排难</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows%E6%9C%AC%E5%9C%B0%E7%BD%91%E5%8D%A1%EF%BC%88%E4%B8%8A%E8%A1%8C%EF%BC%89%E9%80%9F%E5%BA%A6%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E10Gbps-NAS%E7%BD%91%E5%8D%A1%EF%BC%88%E4%B8%8B%E8%A1%8C%EF%BC%89%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E10Gbps%EF%BC%9F"><span class="toc-number">3.2.</span> <span class="toc-text">Windows本地网卡（上行）速度大于等于10Gbps &amp;&amp; NAS网卡（下行）大于等于10Gbps？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-2"><span class="toc-number">3.2.1.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E9%9A%BE-2"><span class="toc-number">3.2.2.</span> <span class="toc-text">排难</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAS%E7%A3%81%E7%9B%98%E5%86%99%E5%85%A5%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E10Gbps%EF%BC%9F"><span class="toc-number">3.3.</span> <span class="toc-text">NAS磁盘写入大于等于10Gbps？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-3"><span class="toc-number">3.3.1.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E9%9A%BE-3"><span class="toc-number">3.3.2.</span> <span class="toc-text">排难</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows%E4%BB%A5%E5%8F%8ANAS%E6%BB%A1%E8%B6%B3SMB-10Gbps%E5%8D%95%E6%A0%B8%E6%80%A7%E8%83%BD%EF%BC%9F"><span class="toc-number">3.4.</span> <span class="toc-text">Windows以及NAS满足SMB 10Gbps单核性能？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8-%E5%A4%87%E6%B3%A8"><span class="toc-number">4.0.1.</span> <span class="toc-text">引用&amp;&amp;备注</span></a></li></ol></li></ol></div></button> <a href="#nexmoe-content" class="backtop toc-link" aria-label="Back To Top" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a></div></div></div></div><div id="nexmoe-footer"></div><div id="nexmoe-search-space"><div class="search-container"><div class="search-header"><div class="search-input-container"><input class="search-input" type="text" placeholder="Search" oninput="sinput()"></div><a class="search-close" onclick="sclose()">×</a></div><div class="search-body"></div></div></div><div></div><script>const CODE_CONFIG={beautify:!1,highlightCopy:!0,highlightLang:void 0,highlightHeightLimit:void 0,isHighlightShrink:void 0,copy:{success:"Copy Success",error:"Copy Error",noSupport:"Browser Not Support"}};console.log("%c hexo-shiki-plugin %c v1.0.27 %c https://github.com/nova1751/hexo-shiki-plugin","color: #fff; background: #5f5f5f","color: #fff; background: #80c8f8","")</script></body></html>